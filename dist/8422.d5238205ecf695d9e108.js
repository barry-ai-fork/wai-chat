"use strict";(self.webpackChunktelegram_t=self.webpackChunktelegram_t||[]).push([[8422],{27225:(t,e,a)=>{a.d(e,{Co:()=>v,X9:()=>_,ft:()=>A});var i=a(33555),o=a(6137),s=a(91713),d=a(83716),n=a(71226),c=a(25260),r=a(11192),l=a(60782),h=a(69118),u=a(56112),I=a(53551),p=a(78958),V=a(42431),f=a(16974),C=a(50711),w=a(9211),b=a(44271),g=a(65054);d.awM;const m=(0,h.P2)((t=>t()),3e3,!0),y=(0,h.Ds)((t=>t()),500,!1,!0);async function R(t,e,a,s,h=!1,u){t=(0,i.Rd)();let I=(0,r.VF)(t)?.message;try{const p=await(0,n.t9)("fetchChats",{limit:d.Ov0,offsetDate:s,archived:"archived"===e,withPinned:h,lastLocalServiceMessage:I});if(!p)return;const{chatIds:V}=p;if(V.length>0&&V[0]===a&&V.shift(),t=(0,i.Rd)(),I=(0,r.VF)(t)?.message,t={...t,chatFolders:p.chatFolders},h&&"active"===e&&"connectionStateLogged"===t.msgClientState){const a=Object.values(t.byTabId),i=a.flatMap((({id:e})=>{const a=(0,r.jr)(t,e);return a?[a]:[]})),o=a.flatMap((({id:e})=>(0,r.P2)(t,e)||[]));t.currentUserId&&t.users.byId[t.currentUserId]&&o.push(t.users.byId[t.currentUserId]),t=(0,c.s5)(t,(0,l.ee)(o.concat(p.users),"id")),t=(0,c.ps)(t,p.userStatusesById),t=(0,c.SL)(t,(0,l.ee)(i.concat(p.chats),"id")),t=(0,c.B1)(t,e,V)}else if(h&&"archived"===e&&"connectionStateLogged"===t.msgClientState)t=(0,c.Sh)(t,(0,l.ee)(p.users,"id")),t=(0,c.zn)(t,p.userStatusesById),t=(0,c.GL)(t,(0,l.ee)(p.chats,"id")),t=(0,c.Mg)(t,e,V);else{const a=(0,l.ee)(p.chats,"id");if(V.includes(d.awM)){const t=a[d.awM];t&&I&&(a[d.awM]={...t,lastMessage:I})}t=(0,c.Sh)(t,(0,l.ee)(p.users,"id")),t=(0,c.zn)(t,p.userStatusesById),t=(0,c.GL)(t,a),t=(0,c.B1)(t,e,V)}t=(0,c.vv)(t,e,p),(u?p.chatIds:Object.keys(p.draftsById)).forEach((e=>{const a=p.draftsById[e],i=(0,r.ci)(t,e,o._f);(a||i)&&((0,r.Ms)(t,e,o._f)?.isLocal||(t=(0,c.pf)(t,e,o._f,"draft",a)))})),(u?p.chatIds:Object.keys(p.replyingToById)).forEach((e=>{const a=p.replyingToById[e],i=(0,r.ci)(t,e,o._f);(a||i)&&(t=(0,c.pf)(t,e,o._f,"replyingToId",a))})),t={...t,chats:{...t.chats,isFullyLoaded:{...t.chats.isFullyLoaded,[e]:!0}}},(0,i.R3)(t)}catch(t){console.error(t)}}async function A(t,e,a,...[o=(0,g._w)()]){const s=await(0,n.t9)("fetchFullChat",a);if(!s)return;const{users:d,userStatusesById:r,fullInfo:h,groupCall:u,membersCount:I}=s;if(t=(0,i.Rd)(),d&&(t=(0,c.Sh)(t,(0,l.ee)(d,"id"))),r&&(t=(0,c.zn)(t,r)),u){const e=(0,V.$5)(t,u.id);t=(0,p.AH)(t,u.id,(0,l.CE)(u,["connectionState"]),void 0,e?void 0:u.participantsCount)}t=(0,c.a4)(t,a.id,{fullInfo:h,...I&&{membersCount:I}}),(0,i.R3)(t);const f=h.stickerSet;return f&&e.loadStickers({stickerSetInfo:{id:f.id,accessHash:f.accessHash},tabId:o}),s}async function v(t,e){t=(0,i.Rd)();const a=(0,r.DI)(t,e);if(a&&!a.isMin)return a;const{chat:o,user:s}=await(0,n.t9)("getChatByUsername",e)||{};return o?(t=(0,i.Rd)(),t=(0,c.a4)(t,o.id,o),s&&(t=(0,c.Nq)(t,s.id,s)),(0,i.R3)(t),o):void 0}async function M(t,e,a,...[o=(0,g._w)()]){const s=await v(t,a);if(!s)return;t=(0,i.Rd)();const d=(0,r.dy)(t,s.id);if(!d)return;if(!(0,u.cS)(d))return;const h=await(0,n.t9)("loadAttachBot",{bot:d});if(t=(0,i.Rd)(),h)return t=(0,c.Sh)(t,(0,l.ee)(h.users,"id")),(0,i.R3)(t),h.bot;e.showNotification({message:C.Iu("WebApp.AddToAttachmentUnavailableError"),tabId:o})}async function P(t,e,a,o,s,...[d=(0,g._w)()]){t=(0,i.Rd)();const n=await M(t,e,o,d);n&&e.callAttachBot({bot:n,chatId:a,..."string"==typeof s&&{startParam:s},tabId:d})}async function _(t,e,a,...[i=(0,g._w)()]){const o=(0,r.Z1)(t,a);if(!o||!(0,u.G9)(o))return o;const s=await async function(t,e,a,...[i=(0,g._w)()]){try{return await(0,n.t9)("migrateChat",a)}catch(t){return void("CHANNELS_TOO_MUCH"===t.message?e.openLimitReachedModal({limit:"channels",tabId:i}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:i}))}}(0,e,o,i);return s?(e.openChat({id:s.id,tabId:i}),s):void 0}(0,i.iw)("preloadTopChatMessages",(async(t,e)=>{const a=new Set;for(let s=0;s<d.ulj;s++){await(0,h.wO)(100),t=(0,i.Rd)();const s=Object.values(t.byTabId).map((({id:e})=>(0,r.Bt)(t,e)?.chatId)).filter(Boolean),n=(0,f.gO)(d.NfV),c=n?.find((t=>!s.includes(t)&&!a.has(t)));if(!c)return;a.add(c),e.loadViewportMessages({chatId:c,threadId:o._f,tabId:(0,g._w)()})}})),(0,i.iw)("openChat",((t,e,a)=>{const{id:i,threadId:s=o._f}=a;if(!i)return;const{currentUserId:d}=t,c=(0,r.Z1)(t,i);if(c?.hasUnreadMark&&e.toggleChatUnread({id:i}),c)(0,u.Hp)(c)&&c.isMin;else if(i===d)(0,n.t9)("fetchChat",{type:"self"});else{const e=(0,r.dy)(t,i);e&&(0,n.t9)("fetchChat",{type:"user",user:e})}s!==o._f&&e.requestThreadInfoUpdate({chatId:i,threadId:s})})),(0,i.iw)("openComments",(async(t,e,a)=>{const{id:s,threadId:h,originChannelId:u,tabId:I=(0,g._w)()}=a;if(h!==o._f){const a=(0,r.qS)(t,s,h);if(a)e.openChat({id:s,threadId:a,tabId:I});else{const a=(0,r.Cm)(t,s,h);if(!a)return;e.openChat({id:d.mzl,tabId:I});const o=await(0,n.t9)("requestThreadInfoUpdate",{chat:a,threadId:h,originChannelId:u});if(!o)return void e.openPreviousChat({tabId:I});t=(0,i.Rd)(),t=(0,c.Sh)(t,(0,l.ee)(o.users,"id")),(0,i.R3)(t),e.openChat({id:s,threadId:o.topMessageId,tabId:I})}}})),(0,i.iw)("openLinkedChat",(async(t,e,a)=>{const{id:i,tabId:o=(0,g._w)()}=a,s=(0,r.Z1)(t,i);if(!s)return;const d=await(0,n.t9)("fetchFullChat",s);d?.fullInfo?.linkedChatId&&e.openChat({id:d.fullInfo.linkedChatId,tabId:o})})),(0,i.iw)("focusMessageInComments",(async(t,e,a)=>{const{chatId:o,threadId:s,messageId:d,tabId:h=(0,g._w)()}=a,u=(0,r.Z1)(t,o);if(!u)return;const I=await(0,n.t9)("requestThreadInfoUpdate",{chat:u,threadId:s});I&&(t=(0,i.Rd)(),t=(0,c.Sh)(t,(0,l.ee)(I.users,"id")),(0,i.R3)(t),e.focusMessage({chatId:o,threadId:s,messageId:d,tabId:h}))})),(0,i.iw)("openSupportChat",(async(t,e,a)=>{const{tabId:i=(0,g._w)()}=a||{},o=(0,r.P_)(t);if(o)return void e.openChat({id:o.id,shouldReplaceHistory:!0,tabId:i});e.openChat({id:d.mzl,shouldReplaceHistory:!0,tabId:i});const s=await(0,n.t9)("fetchChat",{type:"support"});s&&e.openChat({id:s.chatId,shouldReplaceHistory:!0,tabId:i})})),(0,i.iw)("loadAllChats",(async(t,e,a)=>{const o=a.listType;if("archived"===o)return;const{onReplace:s}=a;let{shouldReplace:n}=a,c=0;const l=t=>t.lastMessage?.date||t.joinDate;for(;n||!t.chats.isFullyLoaded[o];){if(c++>=100)return void(d.eMD&&console.error("`actions/loadAllChats`: Infinite loop detected"));if("connectionStateLogged"!==(t=(0,i.Rd)()).msgClientState&&"connectionStateWaitingLogin"!==t.msgClientState&&"connectionStateConnected"!==t.msgClientState)return;const e=!n&&t.chats.listIds[o],a=e?e.map((e=>t.chats.byId[e])).filter((e=>Boolean(e&&l(e))&&e.id!==d.awM&&!(0,r.ep)(t,e.id))).sort(((t,e)=>l(t)-l(e)))[0]:void 0;await R(t,o,a?.id,a?l(a):void 0,n,!0),n&&(s?.(),n=!1),t=(0,i.Rd)()}})),(0,i.iw)("loadFullChat",((t,e,a)=>{const{chatId:i,force:o,tabId:s=(0,g._w)()}=a,d=(0,r.Z1)(t,i);d&&(o?A(t,e,d,s):y((()=>A(t,e,d,s))))})),(0,i.iw)("loadTopChats",(t=>{m((()=>R(t,"active")))})),(0,i.iw)("requestChatUpdate",((t,e,a)=>{const{chatId:i}=a,o=(0,r.Z1)(t,i);o&&(0,n.t9)("requestChatUpdate",{chat:o,...i===d.awM&&{lastLocalMessage:(0,r.VF)(t)?.message}})})),(0,i.iw)("updateChatMutedState",((t,e,a)=>{const{chatId:o,isMuted:s}=a,d=(0,r.Z1)(t,o);d&&(t=(0,c.a4)(t,o,{isMuted:s}),(0,i.R3)(t),(0,n.t9)("updateChatMutedState",{chat:d,isMuted:s}))})),(0,i.iw)("updateTopicMutedState",((t,e,a)=>{const{chatId:o,isMuted:s,topicId:d}=a,l=(0,r.Z1)(t,o);l&&(t=(0,c.Cn)(t,o,d,{isMuted:s}),(0,i.R3)(t),(0,n.t9)("updateTopicMutedState",{chat:l,topicId:d,isMuted:s}))})),(0,i.iw)("createChannel",(async(t,e,a)=>{const{title:o,about:d,photo:l,memberIds:h,tabId:u=(0,g._w)()}=a,I=h.map((e=>(0,r.dy)(t,e))).filter(Boolean);let p;t=(0,b.i)(t,{chatCreation:{progress:s.Nh.InProgress}},u),(0,i.R3)(t);try{p=await(0,n.t9)("createChannel",{title:o,about:d,users:I})}catch(a){t=(0,i.Rd)(),t=(0,b.i)(t,{chatCreation:{progress:s.Nh.Error}},u),(0,i.R3)(t),"CHANNELS_TOO_MUCH"===a.message?e.openLimitReachedModal({limit:"channels",tabId:u}):e.showDialog({data:{...a,hasErrorKey:!0},tabId:u})}if(!p)return;const{id:V,accessHash:f}=p;t=(0,i.Rd)(),t=(0,c.a4)(t,V,p),t=(0,b.i)(t,{chatCreation:{...(0,r.jU)(t,u).chatCreation,progress:p?s.Nh.Complete:s.Nh.Error}},u),(0,i.R3)(t),e.openChat({id:V,shouldReplaceHistory:!0,tabId:u}),V&&f&&l&&await(0,n.t9)("editChatPhoto",{chatId:V,accessHash:f,photo:l})})),(0,i.iw)("joinChannel",(async(t,e,a)=>{const{chatId:i,tabId:o=(0,g._w)()}=a,s=(0,r.Z1)(t,i);if(!s)return;const{id:d,accessHash:c}=s;if(d&&c)try{await(0,n.t9)("joinChannel",{channelId:d,accessHash:c})}catch(t){"CHANNELS_TOO_MUCH"===t.message?e.openLimitReachedModal({limit:"channels",tabId:o}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:o})}})),(0,i.iw)("deleteChatUser",((t,e,a)=>{const{chatId:o,userId:s,tabId:d=(0,g._w)()}=a,l=(0,r.Z1)(t,o),h=(0,r.dy)(t,s);l&&h&&(t=(0,c.Dd)(t,o),(0,i.R3)(t),(0,r.Bt)(t,d)?.chatId===o&&e.openChat({id:void 0,tabId:d}),(0,n.t9)("deleteChatUser",{chat:l,user:h}))})),(0,i.iw)("deleteChat",((t,e,a)=>{const{chatId:o,tabId:s=(0,g._w)()}=a,d=(0,r.Z1)(t,o);d&&(t=(0,c.Dd)(t,o),(0,i.R3)(t),(0,r.Bt)(t,s)?.chatId===o&&e.openChat({id:void 0,tabId:s}),(0,n.t9)("deleteChat",{chatId:d.id}))})),(0,i.iw)("leaveChannel",((t,e,a)=>{const{chatId:o,tabId:s=(0,g._w)()}=a,d=(0,r.Z1)(t,o);if(!d)return;t=(0,c.Dd)(t,o),(0,i.R3)(t),(0,r.Bt)(t,s)?.chatId===o&&e.openChat({id:void 0,tabId:s});const{id:l,accessHash:h}=d;l&&h&&(0,n.t9)("leaveChannel",{channelId:l,accessHash:h})})),(0,i.iw)("deleteChannel",((t,e,a)=>{const{chatId:o,tabId:s=(0,g._w)()}=a,d=(0,r.Z1)(t,o);if(!d)return;t=(0,c.Dd)(t,o),(0,i.R3)(t),(0,r.Bt)(t,s)?.chatId===o&&e.openChat({id:void 0,tabId:s});const{id:l,accessHash:h}=d;l&&h&&(0,n.t9)("deleteChannel",{channelId:l,accessHash:h})})),(0,i.iw)("createGroupChat",(async(t,e,a)=>{const{title:o,memberIds:d,photo:l,tabId:h=(0,g._w)()}=a,u=d.map((e=>(0,r.dy)(t,e))).filter(Boolean);t=(0,b.i)(t,{chatCreation:{progress:s.Nh.InProgress}},h),(0,i.R3)(t);try{const a=await(0,n.t9)("createGroupChat",{title:o,users:u});if(!a)return;const{id:d}=a;t=(0,i.Rd)(),t=(0,c.a4)(t,d,a),t=(0,b.i)(t,{chatCreation:{...(0,r.jU)(t,h).chatCreation,progress:a?s.Nh.Complete:s.Nh.Error}},h),(0,i.R3)(t),e.openChat({id:d,shouldReplaceHistory:!0,tabId:h}),d&&l&&await(0,n.t9)("editChatPhoto",{chatId:d,photo:l})}catch(e){"USERS_TOO_FEW"===e.message&&(t=(0,i.Rd)(),t=(0,b.i)(t,{chatCreation:{...(0,r.jU)(t,h).chatCreation,progress:s.Nh.Error,error:"CreateGroupError"}},h),(0,i.R3)(t))}})),(0,i.iw)("toggleChatPinned",((t,e,a)=>{const{id:i,folderId:o,tabId:s=(0,g._w)()}=a,c=(0,r.Z1)(t,i);if(!c)return;const l=(0,w.M)(t,"dialogFolderPinned");if(o){const e=(0,r.Mw)(t,o);if(e){const a=!(0,r.ep)(t,i,o),{pinnedChatIds:s,includedChatIds:d}=e,c=a?[i,...s||[]]:(s||[]).filter((t=>t!==i)),l=[i,...d];(0,n.t9)("editChatFolder",{id:o,folderUpdate:{...e,pinnedChatIds:c,includedChatIds:l}})}}else{const a=(0,r.Ek)(t,i),o=(0,r.ep)(t,i,"archived"===a?d.WSp:void 0),h=t.chats.orderedPinnedIds["archived"===a?"archived":"active"];if((h?.length||0)>=l&&!o)return void e.openLimitReachedModal({limit:"dialogFolderPinned",tabId:s});(0,n.t9)("toggleChatPinned",{chat:c,shouldBePinned:!o})}})),(0,i.iw)("toggleChatArchived",((t,e,a)=>{const{id:i}=a,o=(0,r.Z1)(t,i);o&&(0,n.t9)("toggleChatArchived",{chat:o,folderId:(0,u.pE)(o)?0:d.WSp})})),(0,i.iw)("loadChatFolders",(async t=>{const e=await(0,n.t9)("fetchChatFolders");e&&(t=(0,i.Rd)(),t={...t,chatFolders:{...t.chatFolders,...e}},(0,i.R3)(t))})),(0,i.iw)("loadRecommendedChatFolders",(async t=>{const e=await(0,n.t9)("fetchRecommendedChatFolders");e&&(t=(0,i.Rd)(),t={...t,chatFolders:{...t.chatFolders,recommended:e}},(0,i.R3)(t))})),(0,i.iw)("editChatFolders",((t,e,a)=>{const{chatId:i,idsToRemove:o,idsToAdd:s,tabId:d=(0,g._w)()}=a,c=(0,w.M)(t,"dialogFiltersChats");s.some((e=>(0,r.Mw)(t,e).includedChatIds.length>=c))?e.openLimitReachedModal({limit:"dialogFiltersChats",tabId:d}):(o.forEach((async e=>{const a=(0,r.Mw)(t,e);a&&await(0,n.t9)("editChatFolder",{id:e,folderUpdate:{...a,pinnedChatIds:a.pinnedChatIds?.filter((t=>t!==i)),includedChatIds:a.includedChatIds.filter((t=>t!==i))}})})),s.forEach((async e=>{const a=(0,r.Mw)(t,e);a&&await(0,n.t9)("editChatFolder",{id:e,folderUpdate:{...a,includedChatIds:a.includedChatIds.concat(i)}})})))})),(0,i.iw)("editChatFolder",((t,e,a)=>{const{id:i,folderUpdate:o}=a,s=(0,r.Mw)(t,i);s&&(0,n.t9)("editChatFolder",{id:i,folderUpdate:{id:i,emoticon:s.emoticon,pinnedChatIds:s.pinnedChatIds,...o}})})),(0,i.iw)("addChatFolder",(async(t,e,a)=>{const{folder:o,tabId:s=(0,g._w)()}=a,{orderedIds:c,byId:r}=t.chatFolders,l=(0,w.M)(t,"dialogFilters");if(Object.keys(r).length>=l)return void e.openLimitReachedModal({limit:"dialogFilters",tabId:s});const h=Math.max(...c||[],d.WSp),{id:u,description:I,...p}=o;if(await(0,n.t9)("editChatFolder",{id:h+1,folderUpdate:{id:h+1,...p}}),!I)return;t=(0,i.Rd)();const{recommended:V}=t.chatFolders;V&&(t={...t,chatFolders:{...t.chatFolders,recommended:V.filter((({id:t})=>t!==u))}},(0,i.R3)(t))})),(0,i.iw)("sortChatFolders",(async(t,e,a)=>{const{folderIds:o}=a;await(0,n.t9)("sortChatFolders",o)&&(t=(0,i.Rd)(),t={...t,chatFolders:{...t.chatFolders,orderedIds:o}},(0,i.R3)(t))})),(0,i.iw)("deleteChatFolder",(async(t,e,a)=>{const{id:i}=a;(0,r.Mw)(t,i)&&await(0,n.t9)("deleteChatFolder",i)})),(0,i.iw)("toggleChatUnread",((t,e,a)=>{const{id:i}=a,s=(0,r.Z1)(t,i);s&&(s.unreadCount?(0,n.t9)("markMessageListRead",{chat:s,threadId:o._f}):(0,n.t9)("toggleDialogUnread",{chat:s,hasUnreadMark:!s.hasUnreadMark}))})),(0,i.iw)("markTopicRead",((t,e,a)=>{const{chatId:o,topicId:s}=a,d=(0,r.Z1)(t,o);if(!d)return;const l=d.topics?.[s]?.lastMessageId;l&&((0,n.t9)("markMessageListRead",{chat:d,threadId:s,maxId:l}),t=(0,i.Rd)(),t=(0,c.Cn)(t,o,s,{unreadCount:0}),t=(0,c.Xg)(t,o,s,{lastReadInboxMessageId:l}),(0,i.R3)(t))})),(0,i.iw)("openChatByInvite",(async(t,e,a)=>{const{hash:i,tabId:o=(0,g._w)()}=a,s=await(0,n.t9)("openChatByInvite",i);s&&e.openChat({id:s.chatId,tabId:o})})),(0,i.iw)("openChatByPhoneNumber",(async(t,e,a)=>{const{phoneNumber:o,startAttach:s,attach:l,tabId:h=(0,g._w)()}=a;e.openChat({id:d.mzl,tabId:h});const u=await async function(t,e){t=(0,i.Rd)();const a=(0,r.Bk)(t,e);if(a&&!a.isMin)return(0,r.Z1)(t,a.id);const{chat:o,user:s}=await(0,n.t9)("getChatByPhoneNumber",e)||{};return o?(t=(0,i.Rd)(),t=(0,c.a4)(t,o.id,o),(0,i.R3)(t),s&&(t=(0,c.Nq)(t,s.id,s),(0,i.R3)(t)),o):void 0}(t,o);if(!u)return e.openPreviousChat({tabId:h}),void e.showNotification({message:C.Iu("lng_username_by_phone_not_found").replace("{phone}",o),tabId:h});e.openChat({id:u.id,tabId:h}),l&&P(t=(0,i.Rd)(),e,u.id,l,s,h)})),(0,i.iw)("openTelegramLink",((t,e,a)=>{const{url:i,tabId:o=(0,g._w)()}=a,{openChatByPhoneNumber:s,openChatByInvite:n,openStickerSet:c,openChatWithDraft:l,joinVoiceChatByLink:h,showNotification:u,focusMessage:p,openInvoice:V,processAttachBotParameters:f,openChatByUsername:C}=e;if(i.match(d.g$l))return void(0,I.ou)(i);const w=new URL(i.toLowerCase().startsWith("http")?i:`https://${i}`);if(d.LBg.has(w.hostname)&&"/"===w.pathname)return void window.open(w.toString(),"_blank","noopener");const b=(d.LBg.has(w.hostname)?"t.me":w.hostname).split(".");if(b.length>3)return;const m=3===b.length?`${b[0]}/${w.pathname}`:w.pathname,[y,R,A]=m.split("/").filter(Boolean).map((t=>decodeURI(t))),v=Object.fromEntries(w.searchParams);let M;"joinchat"===y&&(M=R);const P=!(!v.hasOwnProperty("startattach")||v.startattach)||v.startattach,_=(0,I.GX)(v.choose);if(y.match(/^\+([0-9]+)(\?|$)/))return void s({phoneNumber:y.substr(1,y.length-1),startAttach:P,attach:v.attach,tabId:o});if((y.startsWith(" ")||y.startsWith("+"))&&(M=y.substr(1,y.length-1)),M)return void n({hash:M,tabId:o});if("addstickers"===y||"addemoji"===y)return void c({stickerSetInfo:{shortName:R},tabId:o});const S=R||void 0,B=A?Number(A):void 0,T=v.comment?Number(v.comment):void 0;if("share"===y)l({text:(0,I.QH)(v.url,v.text),tabId:o});else if(v.hasOwnProperty("voicechat")||v.hasOwnProperty("livestream"))h({username:y,inviteHash:v.voicechat||v.livestream,tabId:o});else if("c"===y&&S&&B){const e=`-${S}`;if(!(0,r.Z1)(t,e))return void u({message:"Chat does not exist",tabId:o});p({chatId:e,messageId:B,tabId:o})}else y.startsWith("$")?V({slug:y.substring(1),tabId:o}):"invoice"===y?V({slug:R,tabId:o}):P&&_?f({username:y,filter:_,..."string"==typeof P&&{startParam:P},tabId:o}):C({username:y,messageId:B||Number(S),threadId:B?Number(S):void 0,commentId:T,startParam:v.start,startAttach:P,attach:v.attach,tabId:o})})),(0,i.iw)("acceptInviteConfirmation",(async(t,e,a)=>{const{hash:i,tabId:o=(0,g._w)()}=a,s=await(0,n.t9)("importChatInvite",{hash:i});s&&e.openChat({id:s.id,tabId:o})})),(0,i.iw)("openChatByUsername",(async(t,e,a)=>{const{username:o,messageId:s,commentId:h,startParam:u,startAttach:I,attach:p,threadId:V,tabId:f=(0,g._w)()}=a,C=(0,r.jr)(t,f);if(!h)return!I&&s&&!u&&C?.usernames?.some((t=>t.username===o))?void e.focusMessage({chatId:C.id,threadId:V,messageId:s,tabId:f}):void await async function(t,e,a,o,s,n,c,l,...[h=(0,g._w)()]){t=(0,i.Rd)();const u=(0,r.jr)(t,h);if(c&&!l){const i=await M(t,e,a,h);if(!u||!i)return;return void e.callAttachBot({bot:i,chatId:u.id,..."string"==typeof c&&{startParam:c},tabId:h})}const I=u?.usernames?.some((t=>t.username===a));I||e.openChat({id:d.mzl,tabId:h});const p=await v(t,a);p?(s?e.focusMessage({chatId:p.id,threadId:o,messageId:s,tabId:h}):I||e.openChat({id:p.id,threadId:o,tabId:h}),n&&e.startBot({botId:p.id,param:n}),l&&P(t=(0,i.Rd)(),e,p.id,l,c,h)):I||(e.openPreviousChat({tabId:h}),e.showNotification({message:"User does not exist",tabId:h}))}(t,e,o,V,s,u,I,p,f);const{chatId:w,type:b}=(0,r.Bt)(t,f)||{},m=(0,r.DI)(t,o);if(w&&s&&m&&"thread"===b){const a=(0,r.tZ)(t,w,s);if(a&&a.chatId===w)return void e.focusMessage({chatId:a.chatId,threadId:a.threadId,messageId:h,tabId:f})}if(!s)return;e.openChat({id:d.mzl,tabId:f});const y=await v(t,o);if(!y)return;t=(0,i.Rd)();const R=(0,r.tZ)(t,y.id,s);let A;if(R)A=R.chatId;else{const e=await(0,n.t9)("requestThreadInfoUpdate",{chat:y,threadId:s});if(!e)return;t=(0,i.Rd)(),t=(0,c.Sh)(t,(0,l.ee)(e.users,"id")),(0,i.R3)(t),A=e.discussionChatId}A&&e.focusMessage({chatId:A,threadId:s,messageId:Number(h),tabId:f})})),(0,i.iw)("togglePreHistoryHidden",(async(t,e,a)=>{const{chatId:o,isEnabled:s,tabId:d=(0,g._w)()}=a,r=await _(t,e,o,d);r&&(t=(0,i.Rd)(),t=(0,c.a4)(t,r.id,{fullInfo:{...r.fullInfo,isPreHistoryHidden:s}}),(0,i.R3)(t),(0,n.t9)("togglePreHistoryHidden",{chat:r,isEnabled:s}))})),(0,i.iw)("updateChatDefaultBannedRights",((t,e,a)=>{const{chatId:i,bannedRights:o}=a,s=(0,r.Z1)(t,i);s&&(0,n.t9)("updateChatDefaultBannedRights",{chat:s,bannedRights:o})})),(0,i.iw)("updateChatMemberBannedRights",(async(t,e,a)=>{const{chatId:o,userId:s,bannedRights:d,tabId:l=(0,g._w)()}=a,h=(0,r.dy)(t,s);if(!h)return;const u=await _(t,e,o,l);if(!u)return;await(0,n.t9)("updateChatMemberBannedRights",{chat:u,user:h,bannedRights:d}),t=(0,i.Rd)();const I=(0,r.Z1)(t,o);if(!I||!I.fullInfo)return;const{members:p,kickedMembers:V}=I.fullInfo,f=Boolean(d.viewMessages),C=!Object.keys(d).length;t=(0,c.a4)(t,o,{fullInfo:{...I.fullInfo,...p&&f&&{members:p.filter((t=>t.userId!==s))},...p&&!f&&{members:p.map((t=>t.userId===s?{...t,bannedRights:d}:t))},...C&&V&&{kickedMembers:V.filter((t=>t.userId!==s))}}}),(0,i.R3)(t)})),(0,i.iw)("updateChatAdmin",(async(t,e,a)=>{const{chatId:o,userId:s,adminRights:d,customTitle:l,tabId:h=(0,g._w)()}=a,u=(0,r.dy)(t,s);if(!u)return;const I=await _(t,e,o,h);if(!I)return;await(0,n.t9)("updateChatAdmin",{chat:I,user:u,adminRights:d,customTitle:l});const p=await(0,n.t9)("fetchFullChat",I);if(!p?.fullInfo)return;const{adminMembersById:V}=p.fullInfo,f=!Object.keys(d).length;let C;if(V)if(f){const{[s]:t,...e}=V;C=e}else C={...V,[s]:{...V[s],adminRights:d,customTitle:l}};t=(0,i.Rd)(),t=(0,c.a4)(t,o,{fullInfo:{...p.fullInfo,...C&&{adminMembersById:C}}}),(0,i.R3)(t)})),(0,i.iw)("updateChat",(async(t,e,a)=>{const{chatId:o,title:d,about:l,photo:h,tabId:u=(0,g._w)()}=a,I=(0,r.Z1)(t,o);I&&(t=(0,i.Rd)(),t=(0,c.H9)(t,s.wv.InProgress,u),(0,i.R3)(t),await Promise.all([I.title!==d?(0,n.t9)("updateChatTitle",I,d):void 0,I.fullInfo&&I.fullInfo.about!==l?(0,n.t9)("updateChatAbout",I,l):void 0,h?(0,n.t9)("editChatPhoto",{chatId:o,accessHash:I.accessHash,photo:h}):void 0]),t=(0,i.Rd)(),t=(0,c.H9)(t,s.wv.Complete,u),(0,i.R3)(t))})),(0,i.iw)("updateChatPhoto",(async(t,e,a)=>{const{photo:o,chatId:s,tabId:d=(0,g._w)()}=a,l=(0,r.Z1)(t,s);l&&(t=(0,c.a4)(t,s,{avatarHash:void 0,fullInfo:{...l.fullInfo,profilePhoto:void 0}}),(0,i.R3)(t),await(0,n.t9)("editChatPhoto",{chatId:s,accessHash:l.accessHash,photo:o}),await(0,n.t9)("deleteProfilePhotos",[o]),e.loadFullChat({chatId:s,tabId:d}),e.loadProfilePhotos({profileId:s}))})),(0,i.iw)("deleteChatPhoto",(async(t,e,a)=>{const{photo:o,chatId:s,tabId:d=(0,g._w)()}=a,l=(0,r.Z1)(t,s);if(!l)return;const h=[o];if(l.avatarHash===o.id){const e=l.photos?.[1];e&&h.push(e),t=(0,c.a4)(t,s,{avatarHash:void 0,fullInfo:{...l.fullInfo,profilePhoto:void 0}}),(0,i.R3)(t),await(0,n.t9)("editChatPhoto",{chatId:s,accessHash:l.accessHash,photo:e})}await(0,n.t9)("deleteProfilePhotos",h)&&(e.loadFullChat({chatId:s,tabId:d}),e.loadProfilePhotos({profileId:s}))})),(0,i.iw)("toggleSignatures",((t,e,a)=>{const{chatId:i,isEnabled:o}=a,s=(0,r.Z1)(t,i);s&&(0,n.t9)("toggleSignatures",{chat:s,isEnabled:o})})),(0,i.iw)("loadGroupsForDiscussion",(async t=>{const e=await(0,n.t9)("fetchGroupsForDiscussion");if(!e)return;const a=e.reduce(((t,e)=>(e&&!e.isForum&&(t[e.id]=e),t)),{});t=(0,i.Rd)(),t=(0,c.fZ)(t,a),t={...t,chats:{...t.chats,forDiscussionIds:Object.keys(a)}},(0,i.R3)(t)})),(0,i.iw)("linkDiscussionGroup",(async(t,e,a)=>{const{channelId:o,chatId:s,tabId:d=(0,g._w)()}=a||{},l=(0,r.Z1)(t,o);if(!l)return;const h=await _(t,e,s,d);if(!h)return;let{fullInfo:u}=h;if(!u){const t=await(0,n.t9)("fetchFullChat",h);if(!t)return;u=t.fullInfo}u.isPreHistoryHidden&&(t=(0,i.Rd)(),t=(0,c.a4)(t,h.id,{fullInfo:{...h.fullInfo,isPreHistoryHidden:!1}}),(0,i.R3)(t),await(0,n.t9)("togglePreHistoryHidden",{chat:h,isEnabled:!1})),(0,n.t9)("setDiscussionGroup",{channel:l,chat:h})})),(0,i.iw)("unlinkDiscussionGroup",(async(t,e,a)=>{const{channelId:o,tabId:s=(0,g._w)()}=a,d=(0,r.Z1)(t,o);if(!d)return;let c;d.fullInfo?.linkedChatId&&(c=(0,r.Z1)(t,d.fullInfo.linkedChatId)),await(0,n.t9)("setDiscussionGroup",{channel:d}),c&&A(t=(0,i.Rd)(),e,c,s)})),(0,i.iw)("setActiveChatFolder",((t,e,a)=>{const{activeChatFolder:i,tabId:o=(0,g._w)()}=a;if(!(i+1>(0,w.M)(t,"dialogFilters")))return(0,b.i)(t,{activeChatFolder:i},o);e.openLimitReachedModal({limit:"dialogFilters",tabId:o})})),(0,i.iw)("resetOpenChatWithDraft",((t,e,a)=>{const{tabId:i=(0,g._w)()}=a||{};return(0,b.i)(t,{requestedDraft:void 0},i)})),(0,i.iw)("loadMoreMembers",(async(t,e,a)=>{const{tabId:o=(0,g._w)()}=a||{},{chatId:s}=(0,r.Bt)(t,o)||{},d=s?(0,r.Z1)(t,s):void 0;if(!d||(0,u.G9)(d))return;const h=d.fullInfo?.members?.length||void 0;if(void 0!==h&&void 0!==d.membersCount&&h>=d.membersCount)return;const I=await(0,n.t9)("fetchMembers",d.id,d.accessHash,"recent",h);if(!I)return;const{members:p,users:V,userStatusesById:f}=I;p&&p.length&&(t=(0,i.Rd)(),t=(0,c.Sh)(t,(0,l.ee)(V,"id")),t=(0,c.zn)(t,f),t=(0,c.iX)(t,d,p),(0,i.R3)(t))})),(0,i.iw)("addChatMembers",(async(t,e,a)=>{const{chatId:o,memberIds:d,tabId:c=(0,g._w)()}=a,l=(0,r.Z1)(t,o),h=d.map((e=>(0,r.dy)(t,e))).filter(Boolean);l&&h.length&&(e.setNewChatMembersDialogState({newChatMembersProgress:s.WB.Loading,tabId:c}),await(0,n.t9)("addChatMembers",l,h),e.setNewChatMembersDialogState({newChatMembersProgress:s.WB.Closed,tabId:c}),A(t=(0,i.Rd)(),e,l,c))})),(0,i.iw)("deleteChatMember",(async(t,e,a)=>{const{chatId:o,userId:s,tabId:d=(0,g._w)()}=a,c=(0,r.Z1)(t,o),l=(0,r.dy)(t,s);c&&l&&(await(0,n.t9)("deleteChatMember",c,l),A(t=(0,i.Rd)(),e,c,d))})),(0,i.iw)("toggleIsProtected",((t,e,a)=>{const{chatId:i,isProtected:o}=a,s=(0,r.Z1)(t,i);s&&(0,n.t9)("toggleIsProtected",{chat:s,isProtected:o})})),(0,i.iw)("setChatEnabledReactions",(async(t,e,a)=>{const{chatId:o,enabledReactions:s,tabId:d=(0,g._w)()}=a,c=(0,r.Z1)(t,o);c&&(await(0,n.t9)("setChatEnabledReactions",{chat:c,enabledReactions:s}),A(t=(0,i.Rd)(),e,c,d))})),(0,i.iw)("loadChatSettings",(async(t,e,a)=>{const{chatId:o}=a,s=(0,r.Z1)(t,o);if(!s)return;const d=await(0,n.t9)("fetchChatSettings",s);if(!d)return;const{settings:h,users:u}=d;t=(0,i.Rd)(),t=(0,c.Sh)(t,(0,l.ee)(u,"id")),t=(0,c.a4)(t,s.id,{settings:h}),(0,i.R3)(t)})),(0,i.iw)("toggleJoinToSend",(async(t,e,a)=>{const{chatId:i,isEnabled:o}=a,s=(0,r.Z1)(t,i);s&&((0,u.ZV)(s)||(0,u.eA)(s))&&await(0,n.t9)("toggleJoinToSend",s,o)})),(0,i.iw)("toggleJoinRequest",(async(t,e,a)=>{const{chatId:i,isEnabled:o}=a,s=(0,r.Z1)(t,i);s&&((0,u.ZV)(s)||(0,u.eA)(s))&&await(0,n.t9)("toggleJoinRequest",s,o)})),(0,i.iw)("openForumPanel",((t,e,a)=>{const{chatId:i,tabId:o=(0,g._w)()}=a;return(0,b.i)(t,{forumPanelChatId:i},o)})),(0,i.iw)("closeForumPanel",((t,e,a)=>{const{tabId:i=(0,g._w)()}=a||{};return(0,b.i)(t,{forumPanelChatId:void 0},i)})),(0,i.iw)("processAttachBotParameters",(async(t,e,a)=>{const{username:o,filter:s,startParam:d,tabId:n=(0,g._w)()}=a,c=await M(t,e,o,n);if(!c)return;t=(0,i.Rd)();const{attachMenu:{bots:r}}=t;if(!r[c.id])return t=(0,b.i)(t,{requestedAttachBotInstall:{bot:c,onConfirm:{action:"requestAttachBotInChat",payload:{bot:c,filter:s,startParam:d}}}},n),void(0,i.R3)(t);e.requestAttachBotInChat({bot:c,filter:s,startParam:d,tabId:n})})),(0,i.iw)("loadTopics",(async(t,e,a)=>{const{chatId:o,force:s}=a,h=(0,r.Z1)(t,o);if(!h)return;if(!s&&h.listedTopicIds&&h.listedTopicIds.length===h.topicsCount)return;const u=!s&&h.listedTopicIds?h.listedTopicIds.reduce(((t,e)=>{const a=h.topics?.[e],i=h.topics?.[t];return a&&(!i||a.lastMessageId<i.lastMessageId)?e:t})):void 0,{id:I,date:p,lastMessageId:V}=u&&h.topics?.[u]||{},f=await(0,n.t9)("fetchTopics",{chat:h,offsetTopicId:I,offsetId:V,offsetDate:p,limit:I?d.C1M:d.SC4});f&&(t=(0,i.Rd)(),t=(0,c.Sh)(t,(0,l.ee)(f.users,"id")),t=(0,c.fZ)(t,(0,l.ee)(f.chats,"id")),t=(0,c.m6)(t,f.messages),t=(0,c.XG)(t,o,f.count,f.topics),t=(0,c.Jr)(t,o,f.topics.map((t=>t.id))),Object.entries(f.draftsById||{}).forEach((([e,a])=>{t=(0,c.pf)(t,o,Number(e),"draft",a?.formattedText),t=(0,c.pf)(t,o,Number(e),"replyingToId",a?.replyingToId)})),Object.entries(f.readInboxMessageIdByTopicId||{}).forEach((([e,a])=>{t=(0,c.Xg)(t,o,Number(e),{lastReadInboxMessageId:a})})),(0,i.R3)(t))})),(0,i.iw)("loadTopicById",(async(t,e,a)=>{const{chatId:o,topicId:s}=a,d=(0,r.Z1)(t,o);if(!d)return;const h=await(0,n.t9)("fetchTopicById",{chat:d,topicId:s});if(h)t=(0,i.Rd)(),t=(0,c.Sh)(t,(0,l.ee)(h.users,"id")),t=(0,c.fZ)(t,(0,l.ee)(h.chats,"id")),t=(0,c.m6)(t,h.messages),t=(0,c.Cn)(t,o,s,h.topic),(0,i.R3)(t);else if("tabId"in a&&a.shouldCloseChatOnError){const{tabId:t=(0,g._w)()}=a;e.openChat({id:void 0,tabId:t})}})),(0,i.iw)("toggleForum",(async(t,e,a)=>{const{chatId:o,isEnabled:s,tabId:d=(0,g._w)()}=a,r=await _(t,e,o,d);if(!r)return;t=(0,i.Rd)();const l=r.isForum;t=(0,c.a4)(t,o,{isForum:s}),(0,i.R3)(t),await(0,n.t9)("toggleForum",{chat:r,isEnabled:s})||(t=(0,i.Rd)(),t=(0,c.a4)(t,o,{isForum:l}),(0,i.R3)(t))})),(0,i.iw)("toggleParticipantsHidden",(async(t,e,a)=>{const{chatId:o,isEnabled:s}=a,d=(0,r.Z1)(t,o);if(!d)return;const l=d.fullInfo?.areParticipantsHidden;t=(0,c.a4)(t,o,{fullInfo:{...d.fullInfo,areParticipantsHidden:s}}),(0,i.R3)(t),await(0,n.t9)("toggleParticipantsHidden",{chat:d,isEnabled:s})||void 0===l||(t=(0,i.Rd)(),t=(0,c.a4)(t,o,{fullInfo:{...d.fullInfo,areParticipantsHidden:l}}),(0,i.R3)(t))})),(0,i.iw)("createTopic",(async(t,e,a)=>{const{chatId:o,title:s,iconColor:d,iconEmojiId:c,tabId:l=(0,g._w)()}=a,h=(0,r.Z1)(t,o);if(!h)return;(0,r.jU)(t,l).createTopicPanel&&(t=(0,b.i)(t,{createTopicPanel:{chatId:o,isLoading:!0}},l),(0,i.R3)(t));const u=await(0,n.t9)("createTopic",{chat:h,title:s,iconColor:d,iconEmojiId:c});u&&e.openChat({id:o,threadId:u,shouldReplaceHistory:!0,tabId:l}),e.closeCreateTopicPanel({tabId:l})})),(0,i.iw)("deleteTopic",(async(t,e,a)=>{const{chatId:o,topicId:s}=a,d=(0,r.Z1)(t,o);d&&await(0,n.t9)("deleteTopic",{chat:d,topicId:s})&&(t=(0,i.Rd)(),t=(0,c.BK)(t,o,s),(0,i.R3)(t))})),(0,i.iw)("editTopic",(async(t,e,a)=>{const{chatId:o,topicId:s,tabId:d=(0,g._w)(),...l}=a,h=(0,r.Z1)(t,o),u=h?.topics?.[s];h&&u&&((0,r.jU)(t,d).editTopicPanel&&(t=(0,b.i)(t,{editTopicPanel:{chatId:o,topicId:s,isLoading:!0}},d),(0,i.R3)(t)),await(0,n.t9)("editTopic",{chat:h,topicId:s,...l})&&(t=(0,i.Rd)(),t=(0,c.Cn)(t,o,s,l),(0,i.R3)(t),e.closeEditTopicPanel({tabId:d})))})),(0,i.iw)("toggleTopicPinned",((t,e,a)=>{const{chatId:i,topicId:o,isPinned:s,tabId:d=(0,g._w)()}=a,{topicsPinnedLimit:c}=t.appConfig||{},l=(0,r.Z1)(t,i);l&&l.topics&&c&&(s&&Object.values(l.topics).filter((t=>t.isPinned)).length>=c?e.showNotification({message:C.Iu("LimitReachedPinnedTopics",c,"i"),tabId:d}):(0,n.t9)("togglePinnedTopic",{chat:l,topicId:o,isPinned:s}))}))},88422:(t,e,a)=>{a.d(e,{CW:()=>B,EP:()=>R,FF:()=>P,Mt:()=>S,NH:()=>_,o5:()=>y});var i=a(33555),o=a(71226),s=a(11192),d=a(64319),n=a(27225),c=a(25260),r=a(78958),l=a(42431),h=a(56112),u=a(60782),I=a(74753),p=a(77361),V=a(50711),f=a(44271),C=a(65054);const w="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";let b,g,m;function y(){return R(),Promise.all(Object.values(m).map((t=>{const e=t.src;return t.src=w,t.muted=!0,t.volume=1e-4,t.play().then((()=>{t.pause(),t.volume=1,t.currentTime=0,t.muted=!1,requestAnimationFrame((()=>{t.src=e}))}))})))}function R(){if(m)return;const t=new Audio("./voicechat_join.mp3"),e=new Audio("./voicechat_connecting.mp3");e.loop=!0;const a=new Audio("./voicechat_leave.mp3"),i=new Audio("./voicechat_onallowtalk.mp3"),o=new Audio("./call_busy.mp3"),s=new Audio("./call_connect.mp3"),d=new Audio("./call_end.mp3"),n=new Audio("./call_incoming.mp3");n.loop=!0;const c=new Audio("./call_ringing.mp3");c.loop=!0,m={join:t,allowTalk:i,leave:a,connecting:e,incoming:n,end:d,connect:s,busy:o,ringing:c}}async function A(t,e){const a=await(0,o.t9)("getGroupCall",{call:e});if(!a)return;t=(0,i.Rd)();const s=(0,l.$5)(t,e.id);return t=(0,r.AH)(t,e.id,(0,u.CE)(a.groupCall,["connectionState"]),void 0,s?.isLoaded?void 0:a.groupCall.participantsCount),t=(0,c.Sh)(t,(0,u.ee)(a.users,"id")),t=(0,c.fZ)(t,(0,u.ee)(a.chats,"id")),(0,i.R3)(t),a.groupCall}async function v(t,e,a){const s=await(0,o.t9)("fetchGroupCallParticipants",{call:e,offset:a});s&&(t=(0,i.Rd)(),t=(0,c.Sh)(t,(0,u.ee)(s.users,"id")),t=(0,c.fZ)(t,(0,u.ee)(s.chats,"id")),(0,i.R3)(t))}(0,i.iw)("toggleGroupCallPanel",((t,e,a)=>{const{force:i,tabId:o=(0,C._w)()}=a||{};return(0,f.i)(t,{isCallPanelVisible:"force"in(a||{})?i:!(0,s.jU)(t,o).isCallPanelVisible},o)})),(0,i.iw)("subscribeToGroupCallUpdates",(async(t,e,a)=>{const{subscribed:s,id:d}=a,n=(0,l.$5)(t,d);n&&(s&&(await A(t,n),t=(0,i.Rd)(),await v(t,n)),await(0,o.t9)("toggleGroupCallStartSubscription",{subscribed:s,call:n}))})),(0,i.iw)("createGroupCall",(async(t,e,a)=>{const{chatId:d,tabId:n=(0,C._w)()}=a,c=(0,s.Z1)(t,d);if(!c)return;const l=await(0,o.t9)("createGroupCall",{peer:c});l&&(t=(0,i.Rd)(),t=(0,r.AH)(t,l.id,{...l,chatId:d}),(0,i.R3)(t),e.requestMasterAndJoinGroupCall({id:l.id,accessHash:l.accessHash,tabId:n}))})),(0,i.iw)("createGroupCallInviteLink",(async(t,e,a)=>{const{tabId:i=(0,C._w)()}=a||{},n=(0,l.mU)(t);if(!n||!n.chatId)return;const c=(0,s.Z1)(t,n.chatId);if(!c)return;const r=Boolean((0,h.WS)(c));let{inviteLink:u}=c.fullInfo;r&&(u=await(0,o.t9)("exportGroupCallInvite",{call:n,canSelfUnmute:!1})),u&&((0,d.TE)(u),e.showNotification({message:"Link copied to clipboard",tabId:i}))})),(0,i.iw)("joinVoiceChatByLink",(async(t,e,a)=>{const{username:o,inviteHash:s,tabId:d=(0,C._w)()}=a,c=await(0,n.Co)(t,o);if(!c)return void e.showNotification({message:V.Iu("NoUsernameFound"),tabId:d});t=(0,i.Rd)();const r=await(0,n.ft)(t,e,c,d);r?.groupCall&&e.requestMasterAndJoinGroupCall({id:r.groupCall.id,accessHash:r.groupCall.accessHash,inviteHash:s,tabId:d})})),(0,i.iw)("requestMasterAndJoinGroupCall",((t,e,a)=>{e.requestMasterAndCallAction({action:"joinGroupCall",payload:a,tabId:a.tabId||(0,C._w)()})})),(0,i.iw)("requestMasterAndAcceptCall",((t,e,a)=>{e.requestMasterAndCallAction({action:"acceptCall",payload:void 0,tabId:a?.tabId||(0,C._w)()})})),(0,i.iw)("joinGroupCall",(async(t,e,a)=>{const{chatId:o,id:s,accessHash:d,inviteHash:n,tabId:c=(0,C._w)()}=a;if(!p.Bi)return;if(t.phoneCall)return void e.toggleGroupCallPanel({tabId:c});!function(){const t=new(window.AudioContext||window.webkitAudioContext);b=new Audio,g=t,b.srcObject=M(t),(0,I.Z)(b)}(),R(),B(t=(0,i.Rd)(),e,!0,c);const{groupCalls:{activeGroupCallId:h}}=t;let u=s?(0,l.$5)(t,s):(0,l.Bj)(t,o);u?.id!==h?h?"leaveGroupCall"in e&&e.leaveGroupCall({rejoin:a,tabId:c}):u&&h===u.id?e.toggleGroupCallPanel({tabId:c}):(u||s&&d||(u=await A(t,{id:s,accessHash:d})),u&&(t=(0,i.Rd)(),t=(0,r.AH)(t,u.id,{...u,inviteHash:n},void 0,u.participantsCount+1),t={...t,groupCalls:{...t.groupCalls,activeGroupCallId:u.id}},(0,i.R3)(t),e.toggleGroupCallPanel({force:!1,tabId:c}))):e.toggleGroupCallPanel({tabId:c})})),(0,i.iw)("playGroupCallSound",((t,e,a)=>{const{sound:i}=a;m[i]&&("connecting"!==i&&m.connecting.pause(),"incoming"!==i&&m.incoming.pause(),"ringing"!==i&&m.ringing.pause(),(0,I.Z)(m[i]))})),(0,i.iw)("loadMoreGroupCallParticipants",(t=>{const e=(0,l.mU)(t);e&&v(t,e,e.nextOffset)})),(0,i.iw)("requestMasterAndRequestCall",((t,e,a)=>{e.requestMasterAndCallAction({action:"requestCall",payload:a,tabId:a.tabId||(0,C._w)()})})),(0,i.iw)("requestCall",(async(t,e,a)=>{const{userId:o,isVideo:d,tabId:n=(0,C._w)()}=a;t.phoneCall?e.toggleGroupCallPanel({tabId:n}):(0,s.dy)(t,o)&&(R(),B(t=(0,i.Rd)(),e,d,n),t=(0,i.Rd)(),t={...t,phoneCall:{id:"",state:"requesting",participantId:o,isVideo:d,adminId:t.currentUserId}},(0,i.R3)(t),e.toggleGroupCallPanel({force:!1,tabId:n}))}));const M=t=>{const e=t.createOscillator(),a=e.connect(t.createMediaStreamDestination());return e.start(),new MediaStream([Object.assign(a.stream.getAudioTracks()[0],{enabled:!1})])};function P(){return b}function _(){return g}function S(){b?.pause(),g=void 0,b=void 0}function B(t,e,a,...[i=(0,C._w)()]){a?navigator.mediaDevices.getUserMedia({video:!0}).then((t=>{0===t.getVideoTracks().length?e.showNotification({message:V.Iu("Call.Camera.Error"),tabId:i}):T(0,e,i)})).catch((()=>{e.showNotification({message:V.Iu("Call.Camera.Error"),tabId:i})})):T(0,e,i)}function T(t,e,...[a=(0,C._w)()]){navigator.mediaDevices.getUserMedia({audio:!0}).then((t=>{0===t.getAudioTracks().length&&e.showNotification({message:V.Iu("RequestAcces.Error.HaveNotAccess.Call"),tabId:a})})).catch((()=>{e.showNotification({message:V.Iu("RequestAcces.Error.HaveNotAccess.Call"),tabId:a})}))}},78958:(t,e,a)=>{a.d(e,{AH:()=>n,B6:()=>l,Ic:()=>r,dc:()=>c});var i=a(42431),o=a(60782),s=a(53475),d=a(11192);function n(t,e,a,i,s){const d=Object.values({...t.groupCalls.byId[e]?.participants,...a.participants}).filter((({isLeft:t})=>!t)).reduce(((t,e)=>(t[e.id]=e,t)),{});return{...t,groupCalls:{...t.groupCalls,byId:{...t.groupCalls.byId,[e]:{...t.groupCalls.byId[e],...(0,o.CE)(a,["participantsCount"]),...i&&{participantsCount:t.groupCalls.byId[e].participantsCount+i},...void 0!==s&&{participantsCount:s},participants:d}}}}}function c(t,e){const a=(0,i.$5)(t,e);if(a&&a.chatId){const e=(0,d.Z1)(t,a.chatId);e&&(t=(0,s.a4)(t,a.chatId,{fullInfo:{...e.fullInfo,groupCallId:void 0}}))}return{...t,groupCalls:{...t.groupCalls,byId:{...(0,o.CE)(t.groupCalls.byId,[e.toString()])}}}}function r(t,e,a){return t.groupCalls.activeGroupCallId?n(t,t.groupCalls.activeGroupCallId,e,void 0,a):t}function l(t,e,a,o,s=!1){const d=(0,i.$5)(t,e);return d?n(t,e,{participants:{...d.participants,[a]:{...d.participants[a],...o}}},o.isLeft?s?0:-1:d.participants[a]||s?0:1):t}}}]);
//# sourceMappingURL=8422.d5238205ecf695d9e108.js.map