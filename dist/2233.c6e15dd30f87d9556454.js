(self.webpackChunkwai=self.webpackChunkwai||[]).push([[2233],{6999:(t,e,a)=>{"use strict";a(13522),a(55237),a(3192),a(67606),a(15023)},14288:(t,e,a)=>{"use strict";a(13522)},66175:(t,e,a)=>{"use strict";a(13522),a(3192),a(55237)},55237:(t,e,a)=>{"use strict";a(13522),a(48960)},81900:(t,e,a)=>{"use strict";function s(t){const{flags:e,CONSTRUCTOR_ID:a,SUBCLASS_OF_ID:s,className:n,classType:i,getBytes:o,...r}=t;return r}a.d(e,{f:()=>s})},3192:(t,e,a)=>{"use strict";a.d(e,{gK:()=>c}),a(13522),a(59187);var s=a(83716);a(67606),a(55237),a(4973),a(64250),a(14288),a(78058);const n=1676e9,i=100,o=1e6;let r=s.MPN;function c(){const t=Math.round((Date.now()-n)/i);return s.MPN+t+ ++r/o}},94830:(t,e,a)=>{"use strict";a(13522),a(3192),a(92582),a(64250)},67606:(t,e,a)=>{"use strict";a(13522),a(55237),a(15023)},92582:(t,e,a)=>{"use strict";a(13522),a(6999),a(55237)},4973:(t,e,a)=>{"use strict";a(24736),a(13522),a(89618),a(59187),a(15023),a(64250),a(83716)},64250:(t,e,a)=>{"use strict";a(13522),a(15023),a(48764).Buffer},15023:(t,e,a)=>{"use strict";a.d(e,{ZP:()=>f});var s=a(24736),n=a.n(s),i=a(81900),o=a(83716),r=a(57404),c=a(69118),d=a(48764).Buffer;const l="BroadcastChannel"in self,u=l?new BroadcastChannel(o.tuy):void 0;let h=[];const p=(0,c.P2)((()=>{u.postMessage({type:"localDbUpdate",batchedUpdates:h}),h=[]}),100);function g(t){if(t instanceof Uint8Array)return d.from(t);if("object"==typeof t&&1===Object.keys(t).length&&"value"===Object.keys(t)[0])return n()(t.value);if(Array.isArray(t))return t.map(g);if("object"!=typeof t||!("CONSTRUCTOR_ID"in t))return t;const e=t.className.split(".").reduce(((t,e)=>t[e]),r.constructors),a=(0,i.f)(t);return new e(Object.keys(a).reduce(((t,e)=>(t[e]=g(a[e]),t)),{}))}const f=["localMessages","chats","users","messages","documents","stickerSets","photos","webDocuments","cache","botWaitReply"].reduce(((t,e)=>{var a;const s=null!==(a=I?.[e])&&void 0!==a?a:{},n=Object.keys(s).reduce(((t,e)=>(t[e]=g(s[e]),t)),{});var i;return t[e]=l?(i=e,new Proxy(n,{get:(t,e,a)=>Reflect.get(t,e,a),set:(t,e,a)=>(h.push({name:i,prop:e,value:a}),p(),Reflect.set(t,e,a))})):n,t}),{});var I},17907:(t,e,a)=>{"use strict";a(13522),a(83716)},55301:(t,e,a)=>{"use strict";a.d(e,{JT:()=>{}}),a(13522);var s=a(89832),n=a(83716);a(17907),a(87426),a(3192),a(59187),a(15023),a(49524),a(4973),a(33839),a(63024),a(82752),a(48764).Buffer,new Set(["msg","sticker","gif","wallpaper","photo","webDocument","document","videoAvatar"]),a(92582),a(64250),a(83579),a(44107),a(60054),a(37869),a(58569),a(48764).Buffer,s.Logger.setLevel(n.jr7?"debug":"warn")},87426:(t,e,a)=>{"use strict";a(13522),a(83716),a(3192),a(66175),a(92582),a(4973),a(15023),a(64250),a(94830),a(55237),a(14288),a(67606),a(6999),new Set},27225:(t,e,a)=>{"use strict";a.d(e,{Co:()=>P,X9:()=>A,ft:()=>S});var s=a(33555),n=a(59187),i=a(91713),o=a(83716),r=a(71226),c=a(25260),d=a(11192),l=a(60782),u=a(69118),h=a(56112),p=a(53551),g=a(78958),f=a(42431),I=a(16974),m=a(50711),w=a(9211),b=a(44271),y=a(65054),C=a(60054),v=a(21591);o.awM;const V=(0,u.P2)((t=>t()),3e3,!0),R=(0,u.Ds)((t=>t()),500,!1,!0);async function M(t,e,a,i,r=!1,u){t=(0,s.Rd)();let h=(0,d.VF)(t)?.message;try{let i;if(t.users.byId[C.gg])return t={...t,chats:{...t.chats,isFullyLoaded:{...t.chats.isFullyLoaded,[e]:!0}}},void(0,s.R3)(t);i=C.H8;for(let e=0;e<i.chats.length;e++){const a=i.chats[e];if(t.messages.byChatId[a.id]){const{threadsById:s,byId:n}=t.messages.byChatId[a.id];s[-1]&&s[-1].lastViewportIds&&s[-1].lastViewportIds.length>0&&(i.chats[e].lastMessage=n[s[-1].lastViewportIds[s[-1].lastViewportIds.length-1]])}}const p={};i.users.forEach((t=>{p[t.id]={type:"userStatusEmpty"}})),i.userStatusesById=p,t=(0,s.Rd)(),i.chatIds=i.chats.map((t=>t.id));const{chatIds:g}=i;g.length>0&&g[0]===a&&g.shift(),i.totalChatCount=i.chats.length,h=(0,d.VF)(t)?.message;const f={};i.chatFolders?.forEach((t=>{f[t.id]=t}));const I=i.chatFolders&&i.chatFolders.length>0?i.folderIds:[0];if(t={...t,chatFolders:{byId:{...f},orderedIds:I}},r&&"active"===e&&"connectionStateLogged"===t.msgClientState){const a=Object.values(t.byTabId),s=a.flatMap((({id:e})=>{const a=(0,d.jr)(t,e);return a?[a]:[]})),n=a.flatMap((({id:e})=>(0,d.P2)(t,e)||[]));t.currentUserId&&t.users.byId[t.currentUserId]&&n.push(t.users.byId[t.currentUserId]),t=(0,c.s5)(t,(0,l.ee)(n.concat(i.users),"id")),t=(0,c.ps)(t,i.userStatusesById),t=(0,c.SL)(t,(0,l.ee)(s.concat(i.chats),"id")),t=(0,c.B1)(t,e,g)}else if(r&&"archived"===e&&"connectionStateLogged"===t.msgClientState)t=(0,c.Sh)(t,(0,l.ee)(i.users,"id")),t=(0,c.zn)(t,i.userStatusesById),t=(0,c.GL)(t,(0,l.ee)(i.chats,"id")),t=(0,c.Mg)(t,e,g);else{const a=(0,l.ee)(i.chats,"id");if(g.includes(o.awM)){const t=a[o.awM];t&&h&&(a[o.awM]={...t,lastMessage:h})}t=(0,c.Sh)(t,(0,l.ee)(i.users,"id")),t=(0,c.zn)(t,i.userStatusesById),t=(0,c.GL)(t,a),t=(0,c.B1)(t,e,g)}t=(0,c.vv)(t,e,i),(u?i.chatIds:Object.keys(i.draftsById)).forEach((e=>{const a=i.draftsById[e],s=(0,d.ci)(t,e,n._f);(a||s)&&((0,d.Ms)(t,e,n._f)?.isLocal||(t=(0,c.pf)(t,e,n._f,"draft",a)))})),(u?i.chatIds:Object.keys(i.replyingToById)).forEach((e=>{const a=i.replyingToById[e],s=(0,d.ci)(t,e,n._f);(a||s)&&(t=(0,c.pf)(t,e,n._f,"replyingToId",a))})),t={...t,chats:{...t.chats,isFullyLoaded:{...t.chats.isFullyLoaded,[e]:!0}}},(0,s.R3)(t)}catch(t){console.error(t)}}async function S(t,e,a,...[n=(0,y._w)()]){const i=await(0,r.t9)("fetchFullChat",a);if(!i)return;const{users:o,userStatusesById:d,fullInfo:u,groupCall:h,membersCount:p}=i;if(t=(0,s.Rd)(),o&&(t=(0,c.Sh)(t,(0,l.ee)(o,"id"))),d&&(t=(0,c.zn)(t,d)),h){const e=(0,f.$5)(t,h.id);t=(0,g.AH)(t,h.id,(0,l.CE)(h,["connectionState"]),void 0,e?void 0:h.participantsCount)}t=(0,c.a4)(t,a.id,{fullInfo:u,...p&&{membersCount:p}}),(0,s.R3)(t);const I=u.stickerSet;return I&&e.loadStickers({stickerSetInfo:{id:I.id,accessHash:I.accessHash},tabId:n}),i}async function P(t,e){t=(0,s.Rd)();const a=(0,d.DI)(t,e);if(a&&!a.isMin)return a;const{chat:n,user:i}=await(0,r.t9)("getChatByUsername",e)||{};return n?(t=(0,s.Rd)(),t=(0,c.a4)(t,n.id,n),i&&(t=(0,c.Nq)(t,i.id,i)),(0,s.R3)(t),n):void 0}async function D(t,e,a,...[n=(0,y._w)()]){const i=await P(t,a);if(!i)return;t=(0,s.Rd)();const o=(0,d.dy)(t,i.id);if(!o)return;if(!(0,h.cS)(o))return;const u=await(0,r.t9)("loadAttachBot",{bot:o});if(t=(0,s.Rd)(),u)return t=(0,c.Sh)(t,(0,l.ee)(u.users,"id")),(0,s.R3)(t),u.bot;e.showNotification({message:m.Iu("WebApp.AddToAttachmentUnavailableError"),tabId:n})}async function _(t,e,a,n,i,...[o=(0,y._w)()]){t=(0,s.Rd)();const r=await D(t,e,n,o);r&&e.callAttachBot({bot:r,chatId:a,..."string"==typeof i&&{startParam:i},tabId:o})}async function A(t,e,a,...[s=(0,y._w)()]){const n=(0,d.Z1)(t,a);if(!n||!(0,h.G9)(n))return n;const i=await async function(t,e,a,...[s=(0,y._w)()]){try{return await(0,r.t9)("migrateChat",a)}catch(t){return void("CHANNELS_TOO_MUCH"===t.message?e.openLimitReachedModal({limit:"channels",tabId:s}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:s}))}}(0,e,n,s);return i?(e.openChat({id:i.id,tabId:s}),i):void 0}(0,s.iw)("preloadTopChatMessages",(async(t,e)=>{const a=new Set;for(let i=0;i<o.ulj;i++){await(0,u.wO)(100),t=(0,s.Rd)();const i=Object.values(t.byTabId).map((({id:e})=>(0,d.Bt)(t,e)?.chatId)).filter(Boolean),r=(0,I.gO)(o.NfV),c=r?.find((t=>!i.includes(t)&&!a.has(t)));if(!c)return;a.add(c),e.loadViewportMessages({chatId:c,threadId:n._f,tabId:(0,y._w)()})}})),(0,s.iw)("openChat",((t,e,a)=>{const{id:s,threadId:i=n._f}=a;if(!s)return;const{currentUserId:o}=t,c=(0,d.Z1)(t,s);if(c?.hasUnreadMark&&e.toggleChatUnread({id:s}),c)(0,h.Hp)(c)&&c.isMin;else if(s===o)(0,r.t9)("fetchChat",{type:"self"});else{const e=(0,d.dy)(t,s);e&&(0,r.t9)("fetchChat",{type:"user",user:e})}i!==n._f&&e.requestThreadInfoUpdate({chatId:s,threadId:i})})),(0,s.iw)("openComments",(async(t,e,a)=>{const{id:i,threadId:u,originChannelId:h,tabId:p=(0,y._w)()}=a;if(u!==n._f){const a=(0,d.qS)(t,i,u);if(a)e.openChat({id:i,threadId:a,tabId:p});else{const a=(0,d.Cm)(t,i,u);if(!a)return;e.openChat({id:o.mzl,tabId:p});const n=await(0,r.t9)("requestThreadInfoUpdate",{chat:a,threadId:u,originChannelId:h});if(!n)return void e.openPreviousChat({tabId:p});t=(0,s.Rd)(),t=(0,c.Sh)(t,(0,l.ee)(n.users,"id")),(0,s.R3)(t),e.openChat({id:i,threadId:n.topMessageId,tabId:p})}}})),(0,s.iw)("openLinkedChat",(async(t,e,a)=>{const{id:s,tabId:n=(0,y._w)()}=a,i=(0,d.Z1)(t,s);if(!i)return;const o=await(0,r.t9)("fetchFullChat",i);o?.fullInfo?.linkedChatId&&e.openChat({id:o.fullInfo.linkedChatId,tabId:n})})),(0,s.iw)("focusMessageInComments",(async(t,e,a)=>{const{chatId:n,threadId:i,messageId:o,tabId:u=(0,y._w)()}=a,h=(0,d.Z1)(t,n);if(!h)return;const p=await(0,r.t9)("requestThreadInfoUpdate",{chat:h,threadId:i});p&&(t=(0,s.Rd)(),t=(0,c.Sh)(t,(0,l.ee)(p.users,"id")),(0,s.R3)(t),e.focusMessage({chatId:n,threadId:i,messageId:o,tabId:u}))})),(0,s.iw)("openSupportChat",(async(t,e,a)=>{const{tabId:s=(0,y._w)()}=a||{},n=(0,d.P_)(t);if(n)return void e.openChat({id:n.id,shouldReplaceHistory:!0,tabId:s});e.openChat({id:o.mzl,shouldReplaceHistory:!0,tabId:s});const i=await(0,r.t9)("fetchChat",{type:"support"});i&&e.openChat({id:i.chatId,shouldReplaceHistory:!0,tabId:s})})),(0,s.iw)("loadAllChats",(async(t,e,a)=>{const n=a.listType;if("archived"===n)return;const{onReplace:i}=a;let{shouldReplace:r}=a,c=0;const l=t=>t.lastMessage?.date||t.joinDate;for(;r||!t.chats.isFullyLoaded[n];){if(c++>=100)return void(o.eMD&&console.error("`actions/loadAllChats`: Infinite loop detected"));if("connectionStateLogged"!==(t=(0,s.Rd)()).msgClientState&&"connectionStateWaitingLogin"!==t.msgClientState&&"connectionStateConnected"!==t.msgClientState)return;const e=!r&&t.chats.listIds[n],a=e?e.map((e=>t.chats.byId[e])).filter((e=>Boolean(e&&l(e))&&e.id!==o.awM&&!(0,d.ep)(t,e.id))).sort(((t,e)=>l(t)-l(e)))[0]:void 0;await M(t,n,a?.id,a&&l(a),r,!0),r&&(i?.(),r=!1),t=(0,s.Rd)()}})),(0,s.iw)("loadFullChat",((t,e,a)=>{const{chatId:s,force:n,tabId:i=(0,y._w)()}=a,o=(0,d.Z1)(t,s);o&&(n?S(t,e,o,i):R((()=>S(t,e,o,i))))})),(0,s.iw)("loadTopChats",(t=>{V((()=>M(t,"active")))})),(0,s.iw)("requestChatUpdate",((t,e,a)=>{const{chatId:s}=a,n=(0,d.Z1)(t,s);n&&(0,r.t9)("requestChatUpdate",{chat:n,...s===o.awM&&{lastLocalMessage:(0,d.VF)(t)?.message}})})),(0,s.iw)("updateChatMutedState",((t,e,a)=>{const{chatId:n,isMuted:i}=a,o=(0,d.Z1)(t,n);o&&(t=(0,c.a4)(t,n,{isMuted:i}),(0,s.R3)(t),(0,r.t9)("updateChatMutedState",{chat:o,isMuted:i}))})),(0,s.iw)("updateTopicMutedState",((t,e,a)=>{const{chatId:n,isMuted:i,topicId:o}=a,l=(0,d.Z1)(t,n);l&&(t=(0,c.Cn)(t,n,o,{isMuted:i}),(0,s.R3)(t),(0,r.t9)("updateTopicMutedState",{chat:l,topicId:o,isMuted:i}))})),(0,s.iw)("createChannel",(async(t,e,a)=>{const{title:n,about:o,photo:l,memberIds:u,tabId:h=(0,y._w)()}=a,p=u.map((e=>(0,d.dy)(t,e))).filter(Boolean);let g;t=(0,b.i)(t,{chatCreation:{progress:i.Nh.InProgress}},h),(0,s.R3)(t);try{g=await(0,r.t9)("createChannel",{title:n,about:o,users:p})}catch(a){t=(0,s.Rd)(),t=(0,b.i)(t,{chatCreation:{progress:i.Nh.Error}},h),(0,s.R3)(t),"CHANNELS_TOO_MUCH"===a.message?e.openLimitReachedModal({limit:"channels",tabId:h}):e.showDialog({data:{...a,hasErrorKey:!0},tabId:h})}if(!g)return;const{id:f,accessHash:I}=g;t=(0,s.Rd)(),t=(0,c.a4)(t,f,g),t=(0,b.i)(t,{chatCreation:{...(0,d.jU)(t,h).chatCreation,progress:g?i.Nh.Complete:i.Nh.Error}},h),(0,s.R3)(t),e.openChat({id:f,shouldReplaceHistory:!0,tabId:h}),f&&I&&l&&await(0,r.t9)("editChatPhoto",{chatId:f,accessHash:I,photo:l})})),(0,s.iw)("joinChannel",(async(t,e,a)=>{const{chatId:s,tabId:n=(0,y._w)()}=a,i=(0,d.Z1)(t,s);if(!i)return;const{id:o,accessHash:c}=i;if(o&&c)try{await(0,r.t9)("joinChannel",{channelId:o,accessHash:c})}catch(t){"CHANNELS_TOO_MUCH"===t.message?e.openLimitReachedModal({limit:"channels",tabId:n}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:n})}})),(0,s.iw)("deleteChatUser",((t,e,a)=>{const{chatId:n,userId:i,tabId:o=(0,y._w)()}=a,l=(0,d.Z1)(t,n),u=(0,d.dy)(t,i);l&&u&&(t=(0,c.Dd)(t,n),(0,s.R3)(t),(0,d.Bt)(t,o)?.chatId===n&&e.openChat({id:void 0,tabId:o}),(0,r.t9)("deleteChatUser",{chat:l,user:u}))})),(0,s.iw)("deleteChat",((t,e,a)=>{const{chatId:n,tabId:i=(0,y._w)()}=a,o=(0,d.Z1)(t,n);o&&(t=(0,c.Dd)(t,n),(0,s.R3)(t),(0,d.Bt)(t,i)?.chatId===n&&e.openChat({id:void 0,tabId:i}),(0,r.t9)("deleteChat",{chatId:o.id}))})),(0,s.iw)("leaveChannel",((t,e,a)=>{const{chatId:n,tabId:i=(0,y._w)()}=a,o=(0,d.Z1)(t,n);if(!o)return;t=(0,c.Dd)(t,n),(0,s.R3)(t),(0,d.Bt)(t,i)?.chatId===n&&e.openChat({id:void 0,tabId:i});const{id:l,accessHash:u}=o;l&&u&&(0,r.t9)("leaveChannel",{channelId:l,accessHash:u})})),(0,s.iw)("deleteChannel",((t,e,a)=>{const{chatId:n,tabId:i=(0,y._w)()}=a,o=(0,d.Z1)(t,n);if(!o)return;t=(0,c.Dd)(t,n),(0,s.R3)(t),(0,d.Bt)(t,i)?.chatId===n&&e.openChat({id:void 0,tabId:i});const{id:l,accessHash:u}=o;l&&u&&(0,r.t9)("deleteChannel",{channelId:l,accessHash:u})})),(0,s.iw)("createChat",(async(t,e,a)=>{const{title:n,about:o,tabId:r=(0,y._w)()}=a;t=(0,b.i)(t,{chatCreation:{progress:i.Nh.InProgress}},r),(0,s.R3)(t);try{const a=Object.keys(t.users.byId);let u=C.gg+1;a.length>0&&(a.sort(((t,e)=>parseInt(e)-parseInt(t))),u=a[0]+1);const h={canBeInvitedToGroup:!1,hasVideoAvatar:!1,type:"userTypeBot",id:u,phoneNumber:"",isMin:!1,noStatus:!0,isSelf:!1,avatarHash:"",accessHash:"",isPremium:!1,firstName:n,photos:[],usernames:[{username:"Bot_"+u,isActive:!0,isEditable:!0}],fullInfo:{isBlocked:!1,noVoiceMessages:!1,bio:o||C.GX,botInfo:{aiBot:{enableAi:!0,chatGptConfig:{init_system_content:"",api_key:"",max_history_length:10,config:C.ep}},botId:u,description:o||C.GX,menuButton:{type:"commands"},commands:C.Tx.map((t=>(t.botId=u,t)))}}};t=(0,s.Rd)();const{chatFolders:p}=t,g=[h],f=[v.Z.buildDefaultChat(h)];let I,m=window.sessionStorage.getItem("activeChatFolder");const w={};m&&Object.values(p.byId).forEach((t=>{t.id===parseInt(m)&&(I=t,t.includedChatIds||(t.includedChatIds=[]),t.includedChatIds.push(u),w[t.id]=t)}));const y={[h.id]:{type:"userStatusEmpty"}};t=(0,s.Rd)(),t=(0,c.Sh)(t,(0,l.ee)(g,"id")),t=(0,c.fZ)(t,(0,l.ee)(f,"id")),t=(0,c.B1)(t,"active",f.map((t=>t.id))),t=(0,c.zn)(t,y),t=(0,b.i)(t,{chatCreation:{...(0,d.jU)(t,r).chatCreation,progress:i.Nh.Complete}},r),(0,s.R3)({...t,chatFolders:{...t.chatFolders,byId:{...t.chatFolders.byId,...w}}}),I&&e.editChatFolder({id:I.id,folderUpdate:I}),e.openChat({id:u,shouldReplaceHistory:!0})}catch(e){console.error(e),t=(0,s.Rd)(),t=(0,b.i)(t,{chatCreation:{...(0,d.jU)(t,r).chatCreation,progress:i.Nh.Error,error:"创建失败"}},r),(0,s.R3)(t)}})),(0,s.iw)("createGroupChat",(async(t,e,a)=>{const{title:n,memberIds:o,photo:l,tabId:u=(0,y._w)()}=a,h=o.map((e=>(0,d.dy)(t,e))).filter(Boolean);t=(0,b.i)(t,{chatCreation:{progress:i.Nh.InProgress}},u),(0,s.R3)(t);try{const a=await(0,r.t9)("createGroupChat",{title:n,users:h});if(!a)return;const{id:o}=a;t=(0,s.Rd)(),t=(0,c.a4)(t,o,a),t=(0,b.i)(t,{chatCreation:{...(0,d.jU)(t,u).chatCreation,progress:a?i.Nh.Complete:i.Nh.Error}},u),(0,s.R3)(t),e.openChat({id:o,shouldReplaceHistory:!0,tabId:u}),o&&l&&await(0,r.t9)("editChatPhoto",{chatId:o,photo:l})}catch(e){"USERS_TOO_FEW"===e.message&&(t=(0,s.Rd)(),t=(0,b.i)(t,{chatCreation:{...(0,d.jU)(t,u).chatCreation,progress:i.Nh.Error,error:"CreateGroupError"}},u),(0,s.R3)(t))}})),(0,s.iw)("toggleChatPinned",((t,e,a)=>{const{id:s,folderId:n,tabId:i=(0,y._w)()}=a,c=(0,d.Z1)(t,s);if(!c)return;const l=(0,w.M)(t,"dialogFolderPinned");if(n){const e=(0,d.Mw)(t,n);if(e){const a=!(0,d.ep)(t,s,n),{pinnedChatIds:i,includedChatIds:o}=e,c=a?[s,...i||[]]:(i||[]).filter((t=>t!==s)),l=[s,...o];(0,r.t9)("editChatFolder",{id:n,folderUpdate:{...e,pinnedChatIds:c,includedChatIds:l}})}}else{const a=(0,d.Ek)(t,s),n=(0,d.ep)(t,s,"archived"===a?o.WSp:void 0),u=t.chats.orderedPinnedIds["archived"===a?"archived":"active"];if((u?.length||0)>=l&&!n)return void e.openLimitReachedModal({limit:"dialogFolderPinned",tabId:i});(0,r.t9)("toggleChatPinned",{chat:c,shouldBePinned:!n})}})),(0,s.iw)("toggleChatArchived",((t,e,a)=>{const{id:s}=a,n=(0,d.Z1)(t,s);n&&(0,r.t9)("toggleChatArchived",{chat:n,folderId:(0,h.pE)(n)?0:o.WSp})})),(0,s.iw)("loadChatFolders",(async t=>{const e=await(0,r.t9)("fetchChatFolders");e&&(t=(0,s.Rd)(),t={...t,chatFolders:{...t.chatFolders,...e}},(0,s.R3)(t))})),(0,s.iw)("loadRecommendedChatFolders",(async t=>{const e=await(0,r.t9)("fetchRecommendedChatFolders");e&&(t=(0,s.Rd)(),t={...t,chatFolders:{...t.chatFolders,recommended:e}},(0,s.R3)(t))})),(0,s.iw)("editChatFolders",((t,e,a)=>{const{chatId:s,idsToRemove:n,idsToAdd:i,tabId:o=(0,y._w)()}=a,c=(0,w.M)(t,"dialogFiltersChats");i.some((e=>(0,d.Mw)(t,e).includedChatIds.length>=c))?e.openLimitReachedModal({limit:"dialogFiltersChats",tabId:o}):(n.forEach((async e=>{const a=(0,d.Mw)(t,e);a&&await(0,r.t9)("editChatFolder",{id:e,folderUpdate:{...a,pinnedChatIds:a.pinnedChatIds?.filter((t=>t!==s)),includedChatIds:a.includedChatIds.filter((t=>t!==s))}})})),i.forEach((async e=>{const a=(0,d.Mw)(t,e);a&&await(0,r.t9)("editChatFolder",{id:e,folderUpdate:{...a,includedChatIds:a.includedChatIds.concat(s)}})})))})),(0,s.iw)("editChatFolder",((t,e,a)=>{const{id:s,folderUpdate:n}=a,i=(0,d.Mw)(t,s);i&&(0,r.t9)("editChatFolder",{id:s,folderUpdate:{id:s,emoticon:i.emoticon,pinnedChatIds:i.pinnedChatIds,...n}})})),(0,s.iw)("addChatFolder",(async(t,e,a)=>{const{folder:n,tabId:i=(0,y._w)()}=a,{orderedIds:c,byId:d}=t.chatFolders,l=(0,w.M)(t,"dialogFilters");if(Object.keys(d).length>=l)return void e.openLimitReachedModal({limit:"dialogFilters",tabId:i});const u=Math.max(...c||[],o.WSp),{id:h,description:p,...g}=n;if(await(0,r.t9)("editChatFolder",{id:u+1,folderUpdate:{id:u+1,...g}}),!p)return;t=(0,s.Rd)();const{recommended:f}=t.chatFolders;f&&(t={...t,chatFolders:{...t.chatFolders,recommended:f.filter((({id:t})=>t!==h))}},(0,s.R3)(t))})),(0,s.iw)("sortChatFolders",(async(t,e,a)=>{const{folderIds:n}=a;await(0,r.t9)("sortChatFolders",n)&&(t=(0,s.Rd)(),t={...t,chatFolders:{...t.chatFolders,orderedIds:n}},(0,s.R3)(t))})),(0,s.iw)("deleteChatFolder",(async(t,e,a)=>{const{id:s}=a,n=(0,d.Mw)(t,s);e.setActiveChatFolder({activeChatFolder:0},(0,y._w)()),n&&await(0,r.t9)("deleteChatFolder",s)})),(0,s.iw)("toggleChatUnread",((t,e,a)=>{const{id:s}=a,i=(0,d.Z1)(t,s);i&&(i.unreadCount?(0,r.t9)("markMessageListRead",{chat:i,threadId:n._f}):(0,r.t9)("toggleDialogUnread",{chat:i,hasUnreadMark:!i.hasUnreadMark}))})),(0,s.iw)("markTopicRead",((t,e,a)=>{const{chatId:n,topicId:i}=a,o=(0,d.Z1)(t,n);if(!o)return;const l=o.topics?.[i]?.lastMessageId;l&&((0,r.t9)("markMessageListRead",{chat:o,threadId:i,maxId:l}),t=(0,s.Rd)(),t=(0,c.Cn)(t,n,i,{unreadCount:0}),t=(0,c.Xg)(t,n,i,{lastReadInboxMessageId:l}),(0,s.R3)(t))})),(0,s.iw)("openChatByInvite",(async(t,e,a)=>{const{hash:s,tabId:n=(0,y._w)()}=a,i=await(0,r.t9)("openChatByInvite",s);i&&e.openChat({id:i.chatId,tabId:n})})),(0,s.iw)("openChatByPhoneNumber",(async(t,e,a)=>{const{phoneNumber:n,startAttach:i,attach:l,tabId:u=(0,y._w)()}=a;e.openChat({id:o.mzl,tabId:u});const h=await async function(t,e){t=(0,s.Rd)();const a=(0,d.Bk)(t,e);if(a&&!a.isMin)return(0,d.Z1)(t,a.id);const{chat:n,user:i}=await(0,r.t9)("getChatByPhoneNumber",e)||{};return n?(t=(0,s.Rd)(),t=(0,c.a4)(t,n.id,n),(0,s.R3)(t),i&&(t=(0,c.Nq)(t,i.id,i),(0,s.R3)(t)),n):void 0}(t,n);if(!h)return e.openPreviousChat({tabId:u}),void e.showNotification({message:m.Iu("lng_username_by_phone_not_found").replace("{phone}",n),tabId:u});e.openChat({id:h.id,tabId:u}),l&&_(t=(0,s.Rd)(),e,h.id,l,i,u)})),(0,s.iw)("openTelegramLink",((t,e,a)=>{const{url:s,tabId:n=(0,y._w)()}=a,{openChatByPhoneNumber:i,openChatByInvite:r,openStickerSet:c,openChatWithDraft:l,joinVoiceChatByLink:u,showNotification:h,focusMessage:g,openInvoice:f,processAttachBotParameters:I,openChatByUsername:m}=e;if(s.match(o.g$l))return void(0,p.ou)(s);const w=new URL(s.toLowerCase().startsWith("http")?s:`https://${s}`);if(o.LBg.has(w.hostname)&&"/"===w.pathname)return void window.open(w.toString(),"_blank","noopener");const b=(o.LBg.has(w.hostname)?"t.me":w.hostname).split(".");if(b.length>3)return;const C=3===b.length?`${b[0]}/${w.pathname}`:w.pathname,[v,V,R]=C.split("/").filter(Boolean).map((t=>decodeURI(t))),M=Object.fromEntries(w.searchParams);let S;"joinchat"===v&&(S=V);const P=!(!M.hasOwnProperty("startattach")||M.startattach)||M.startattach,D=(0,p.GX)(M.choose);if(v.match(/^\+([0-9]+)(\?|$)/))return void i({phoneNumber:v.substr(1,v.length-1),startAttach:P,attach:M.attach,tabId:n});if((v.startsWith(" ")||v.startsWith("+"))&&(S=v.substr(1,v.length-1)),S)return void r({hash:S,tabId:n});if("addstickers"===v||"addemoji"===v)return void c({stickerSetInfo:{shortName:V},tabId:n});const _=V||void 0,A=R?Number(R):void 0,B=M.comment?Number(M.comment):void 0;if("share"===v)l({text:(0,p.QH)(M.url,M.text),tabId:n});else if(M.hasOwnProperty("voicechat")||M.hasOwnProperty("livestream"))u({username:v,inviteHash:M.voicechat||M.livestream,tabId:n});else if("c"===v&&_&&A){const e=`-${_}`;if(!(0,d.Z1)(t,e))return void h({message:"Chat does not exist",tabId:n});g({chatId:e,messageId:A,tabId:n})}else v.startsWith("$")?f({slug:v.substring(1),tabId:n}):"invoice"===v?f({slug:V,tabId:n}):P&&D?I({username:v,filter:D,..."string"==typeof P&&{startParam:P},tabId:n}):m({username:v,messageId:A||Number(_),threadId:A?Number(_):void 0,commentId:B,startParam:M.start,startAttach:P,attach:M.attach,tabId:n})})),(0,s.iw)("acceptInviteConfirmation",(async(t,e,a)=>{const{hash:s,tabId:n=(0,y._w)()}=a,i=await(0,r.t9)("importChatInvite",{hash:s});i&&e.openChat({id:i.id,tabId:n})})),(0,s.iw)("openChatByUsername",(async(t,e,a)=>{const{username:n,messageId:i,commentId:u,startParam:h,startAttach:p,attach:g,threadId:f,tabId:I=(0,y._w)()}=a,m=(0,d.jr)(t,I);if(!u)return!p&&i&&!h&&m?.usernames?.some((t=>t.username===n))?void e.focusMessage({chatId:m.id,threadId:f,messageId:i,tabId:I}):void await async function(t,e,a,n,i,r,c,l,...[u=(0,y._w)()]){t=(0,s.Rd)();const h=(0,d.jr)(t,u);if(c&&!l){const s=await D(t,e,a,u);if(!h||!s)return;return void e.callAttachBot({bot:s,chatId:h.id,..."string"==typeof c&&{startParam:c},tabId:u})}const p=h?.usernames?.some((t=>t.username===a));p||e.openChat({id:o.mzl,tabId:u});const g=await P(t,a);g?(i?e.focusMessage({chatId:g.id,threadId:n,messageId:i,tabId:u}):p||e.openChat({id:g.id,threadId:n,tabId:u}),r&&e.startBot({botId:g.id,param:r}),l&&_(t=(0,s.Rd)(),e,g.id,l,c,u)):p||(e.openPreviousChat({tabId:u}),e.showNotification({message:"User does not exist",tabId:u}))}(t,e,n,f,i,h,p,g,I);const{chatId:w,type:b}=(0,d.Bt)(t,I)||{},C=(0,d.DI)(t,n);if(w&&i&&C&&"thread"===b){const a=(0,d.tZ)(t,w,i);if(a&&a.chatId===w)return void e.focusMessage({chatId:a.chatId,threadId:a.threadId,messageId:u,tabId:I})}if(!i)return;e.openChat({id:o.mzl,tabId:I});const v=await P(t,n);if(!v)return;t=(0,s.Rd)();const V=(0,d.tZ)(t,v.id,i);let R;if(V)R=V.chatId;else{const e=await(0,r.t9)("requestThreadInfoUpdate",{chat:v,threadId:i});if(!e)return;t=(0,s.Rd)(),t=(0,c.Sh)(t,(0,l.ee)(e.users,"id")),(0,s.R3)(t),R=e.discussionChatId}R&&e.focusMessage({chatId:R,threadId:i,messageId:Number(u),tabId:I})})),(0,s.iw)("togglePreHistoryHidden",(async(t,e,a)=>{const{chatId:n,isEnabled:i,tabId:o=(0,y._w)()}=a,d=await A(t,e,n,o);d&&(t=(0,s.Rd)(),t=(0,c.a4)(t,d.id,{fullInfo:{...d.fullInfo,isPreHistoryHidden:i}}),(0,s.R3)(t),(0,r.t9)("togglePreHistoryHidden",{chat:d,isEnabled:i}))})),(0,s.iw)("updateChatDefaultBannedRights",((t,e,a)=>{const{chatId:s,bannedRights:n}=a,i=(0,d.Z1)(t,s);i&&(0,r.t9)("updateChatDefaultBannedRights",{chat:i,bannedRights:n})})),(0,s.iw)("updateChatMemberBannedRights",(async(t,e,a)=>{const{chatId:n,userId:i,bannedRights:o,tabId:l=(0,y._w)()}=a,u=(0,d.dy)(t,i);if(!u)return;const h=await A(t,e,n,l);if(!h)return;await(0,r.t9)("updateChatMemberBannedRights",{chat:h,user:u,bannedRights:o}),t=(0,s.Rd)();const p=(0,d.Z1)(t,n);if(!p||!p.fullInfo)return;const{members:g,kickedMembers:f}=p.fullInfo,I=Boolean(o.viewMessages),m=!Object.keys(o).length;t=(0,c.a4)(t,n,{fullInfo:{...p.fullInfo,...g&&I&&{members:g.filter((t=>t.userId!==i))},...g&&!I&&{members:g.map((t=>t.userId===i?{...t,bannedRights:o}:t))},...m&&f&&{kickedMembers:f.filter((t=>t.userId!==i))}}}),(0,s.R3)(t)})),(0,s.iw)("updateChatAdmin",(async(t,e,a)=>{const{chatId:n,userId:i,adminRights:o,customTitle:l,tabId:u=(0,y._w)()}=a,h=(0,d.dy)(t,i);if(!h)return;const p=await A(t,e,n,u);if(!p)return;await(0,r.t9)("updateChatAdmin",{chat:p,user:h,adminRights:o,customTitle:l});const g=await(0,r.t9)("fetchFullChat",p);if(!g?.fullInfo)return;const{adminMembersById:f}=g.fullInfo,I=!Object.keys(o).length;let m;if(f)if(I){const{[i]:t,...e}=f;m=e}else m={...f,[i]:{...f[i],adminRights:o,customTitle:l}};t=(0,s.Rd)(),t=(0,c.a4)(t,n,{fullInfo:{...g.fullInfo,...m&&{adminMembersById:m}}}),(0,s.R3)(t)})),(0,s.iw)("updateChat",(async(t,e,a)=>{const{chatId:n,title:o,about:l,photo:u,tabId:h=(0,y._w)()}=a,p=(0,d.Z1)(t,n);p&&(t=(0,s.Rd)(),t=(0,c.H9)(t,i.wv.InProgress,h),(0,s.R3)(t),await Promise.all([p.title!==o?(0,r.t9)("updateChatTitle",p,o):void 0,p.fullInfo&&p.fullInfo.about!==l?(0,r.t9)("updateChatAbout",p,l):void 0,u?(0,r.t9)("editChatPhoto",{chatId:n,accessHash:p.accessHash,photo:u}):void 0]),t=(0,s.Rd)(),t=(0,c.H9)(t,i.wv.Complete,h),(0,s.R3)(t))})),(0,s.iw)("updateChatPhoto",(async(t,e,a)=>{const{photo:n,chatId:i,tabId:o=(0,y._w)()}=a,l=(0,d.Z1)(t,i);l&&(t=(0,c.a4)(t,i,{avatarHash:void 0,fullInfo:{...l.fullInfo,profilePhoto:void 0}}),(0,s.R3)(t),await(0,r.t9)("editChatPhoto",{chatId:i,accessHash:l.accessHash,photo:n}),await(0,r.t9)("deleteProfilePhotos",[n]),e.loadFullChat({chatId:i,tabId:o}),e.loadProfilePhotos({profileId:i}))})),(0,s.iw)("deleteChatPhoto",(async(t,e,a)=>{const{photo:n,chatId:i,tabId:o=(0,y._w)()}=a,l=(0,d.Z1)(t,i);if(!l)return;const u=[n];if(l.avatarHash===n.id){const e=l.photos?.[1];e&&u.push(e),t=(0,c.a4)(t,i,{avatarHash:void 0,fullInfo:{...l.fullInfo,profilePhoto:void 0}}),(0,s.R3)(t),await(0,r.t9)("editChatPhoto",{chatId:i,accessHash:l.accessHash,photo:e})}await(0,r.t9)("deleteProfilePhotos",u)&&(e.loadFullChat({chatId:i,tabId:o}),e.loadProfilePhotos({profileId:i}))})),(0,s.iw)("toggleSignatures",((t,e,a)=>{const{chatId:s,isEnabled:n}=a,i=(0,d.Z1)(t,s);i&&(0,r.t9)("toggleSignatures",{chat:i,isEnabled:n})})),(0,s.iw)("loadGroupsForDiscussion",(async t=>{const e=await(0,r.t9)("fetchGroupsForDiscussion");if(!e)return;const a=e.reduce(((t,e)=>(e&&!e.isForum&&(t[e.id]=e),t)),{});t=(0,s.Rd)(),t=(0,c.fZ)(t,a),t={...t,chats:{...t.chats,forDiscussionIds:Object.keys(a)}},(0,s.R3)(t)})),(0,s.iw)("linkDiscussionGroup",(async(t,e,a)=>{const{channelId:n,chatId:i,tabId:o=(0,y._w)()}=a||{},l=(0,d.Z1)(t,n);if(!l)return;const u=await A(t,e,i,o);if(!u)return;let{fullInfo:h}=u;if(!h){const t=await(0,r.t9)("fetchFullChat",u);if(!t)return;h=t.fullInfo}h.isPreHistoryHidden&&(t=(0,s.Rd)(),t=(0,c.a4)(t,u.id,{fullInfo:{...u.fullInfo,isPreHistoryHidden:!1}}),(0,s.R3)(t),await(0,r.t9)("togglePreHistoryHidden",{chat:u,isEnabled:!1})),(0,r.t9)("setDiscussionGroup",{channel:l,chat:u})})),(0,s.iw)("unlinkDiscussionGroup",(async(t,e,a)=>{const{channelId:n,tabId:i=(0,y._w)()}=a,o=(0,d.Z1)(t,n);if(!o)return;let c;o.fullInfo?.linkedChatId&&(c=(0,d.Z1)(t,o.fullInfo.linkedChatId)),await(0,r.t9)("setDiscussionGroup",{channel:o}),c&&S(t=(0,s.Rd)(),e,c,i)})),(0,s.iw)("setActiveChatFolder",((t,e,a)=>{const{activeChatFolder:s,tabId:n=(0,y._w)()}=a;if(!(s+1>(0,w.M)(t,"dialogFilters")))return window.sessionStorage.setItem("activeChatFolder",s.toString()),(0,b.i)(t,{activeChatFolder:s},n);e.openLimitReachedModal({limit:"dialogFilters",tabId:n})})),(0,s.iw)("resetOpenChatWithDraft",((t,e,a)=>{const{tabId:s=(0,y._w)()}=a||{};return(0,b.i)(t,{requestedDraft:void 0},s)})),(0,s.iw)("loadMoreMembers",(async(t,e,a)=>{const{tabId:n=(0,y._w)()}=a||{},{chatId:i}=(0,d.Bt)(t,n)||{},o=i?(0,d.Z1)(t,i):void 0;if(!o||(0,h.G9)(o))return;const u=o.fullInfo?.members?.length||void 0;if(void 0!==u&&void 0!==o.membersCount&&u>=o.membersCount)return;const p=await(0,r.t9)("fetchMembers",o.id,o.accessHash,"recent",u);if(!p)return;const{members:g,users:f,userStatusesById:I}=p;g&&g.length&&(t=(0,s.Rd)(),t=(0,c.Sh)(t,(0,l.ee)(f,"id")),t=(0,c.zn)(t,I),t=(0,c.iX)(t,o,g),(0,s.R3)(t))})),(0,s.iw)("addChatMembers",(async(t,e,a)=>{const{chatId:n,memberIds:o,tabId:c=(0,y._w)()}=a,l=(0,d.Z1)(t,n),u=o.map((e=>(0,d.dy)(t,e))).filter(Boolean);l&&u.length&&(e.setNewChatMembersDialogState({newChatMembersProgress:i.WB.Loading,tabId:c}),await(0,r.t9)("addChatMembers",l,u),e.setNewChatMembersDialogState({newChatMembersProgress:i.WB.Closed,tabId:c}),S(t=(0,s.Rd)(),e,l,c))})),(0,s.iw)("deleteChatMember",(async(t,e,a)=>{const{chatId:n,userId:i,tabId:o=(0,y._w)()}=a,c=(0,d.Z1)(t,n),l=(0,d.dy)(t,i);c&&l&&(await(0,r.t9)("deleteChatMember",c,l),S(t=(0,s.Rd)(),e,c,o))})),(0,s.iw)("toggleIsProtected",((t,e,a)=>{const{chatId:s,isProtected:n}=a,i=(0,d.Z1)(t,s);i&&(0,r.t9)("toggleIsProtected",{chat:i,isProtected:n})})),(0,s.iw)("setChatEnabledReactions",(async(t,e,a)=>{const{chatId:n,enabledReactions:i,tabId:o=(0,y._w)()}=a,c=(0,d.Z1)(t,n);c&&(await(0,r.t9)("setChatEnabledReactions",{chat:c,enabledReactions:i}),S(t=(0,s.Rd)(),e,c,o))})),(0,s.iw)("loadChatSettings",(async(t,e,a)=>{const{chatId:n}=a,i=(0,d.Z1)(t,n);if(!i)return;const o=await(0,r.t9)("fetchChatSettings",i);if(!o)return;const{settings:u,users:h}=o;t=(0,s.Rd)(),t=(0,c.Sh)(t,(0,l.ee)(h,"id")),t=(0,c.a4)(t,i.id,{settings:u}),(0,s.R3)(t)})),(0,s.iw)("toggleJoinToSend",(async(t,e,a)=>{const{chatId:s,isEnabled:n}=a,i=(0,d.Z1)(t,s);i&&((0,h.ZV)(i)||(0,h.eA)(i))&&await(0,r.t9)("toggleJoinToSend",i,n)})),(0,s.iw)("toggleJoinRequest",(async(t,e,a)=>{const{chatId:s,isEnabled:n}=a,i=(0,d.Z1)(t,s);i&&((0,h.ZV)(i)||(0,h.eA)(i))&&await(0,r.t9)("toggleJoinRequest",i,n)})),(0,s.iw)("openForumPanel",((t,e,a)=>{const{chatId:s,tabId:n=(0,y._w)()}=a;return(0,b.i)(t,{forumPanelChatId:s},n)})),(0,s.iw)("closeForumPanel",((t,e,a)=>{const{tabId:s=(0,y._w)()}=a||{};return(0,b.i)(t,{forumPanelChatId:void 0},s)})),(0,s.iw)("processAttachBotParameters",(async(t,e,a)=>{const{username:n,filter:i,startParam:o,tabId:r=(0,y._w)()}=a,c=await D(t,e,n,r);if(!c)return;t=(0,s.Rd)();const{attachMenu:{bots:d}}=t;if(!d[c.id])return t=(0,b.i)(t,{requestedAttachBotInstall:{bot:c,onConfirm:{action:"requestAttachBotInChat",payload:{bot:c,filter:i,startParam:o}}}},r),void(0,s.R3)(t);e.requestAttachBotInChat({bot:c,filter:i,startParam:o,tabId:r})})),(0,s.iw)("loadTopics",(async(t,e,a)=>{const{chatId:n,force:i}=a,u=(0,d.Z1)(t,n);if(!u)return;if(!i&&u.listedTopicIds&&u.listedTopicIds.length===u.topicsCount)return;const h=!i&&u.listedTopicIds?u.listedTopicIds.reduce(((t,e)=>{const a=u.topics?.[e],s=u.topics?.[t];return a&&(!s||a.lastMessageId<s.lastMessageId)?e:t})):void 0,{id:p,date:g,lastMessageId:f}=h&&u.topics?.[h]||{},I=await(0,r.t9)("fetchTopics",{chat:u,offsetTopicId:p,offsetId:f,offsetDate:g,limit:p?o.C1M:o.SC4});I&&(t=(0,s.Rd)(),t=(0,c.Sh)(t,(0,l.ee)(I.users,"id")),t=(0,c.fZ)(t,(0,l.ee)(I.chats,"id")),t=(0,c.m6)(t,I.messages),t=(0,c.XG)(t,n,I.count,I.topics),t=(0,c.Jr)(t,n,I.topics.map((t=>t.id))),Object.entries(I.draftsById||{}).forEach((([e,a])=>{t=(0,c.pf)(t,n,Number(e),"draft",a?.formattedText),t=(0,c.pf)(t,n,Number(e),"replyingToId",a?.replyingToId)})),Object.entries(I.readInboxMessageIdByTopicId||{}).forEach((([e,a])=>{t=(0,c.Xg)(t,n,Number(e),{lastReadInboxMessageId:a})})),(0,s.R3)(t))})),(0,s.iw)("loadTopicById",(async(t,e,a)=>{const{chatId:n,topicId:i}=a,o=(0,d.Z1)(t,n);if(!o)return;const u=await(0,r.t9)("fetchTopicById",{chat:o,topicId:i});if(u)t=(0,s.Rd)(),t=(0,c.Sh)(t,(0,l.ee)(u.users,"id")),t=(0,c.fZ)(t,(0,l.ee)(u.chats,"id")),t=(0,c.m6)(t,u.messages),t=(0,c.Cn)(t,n,i,u.topic),(0,s.R3)(t);else if("tabId"in a&&a.shouldCloseChatOnError){const{tabId:t=(0,y._w)()}=a;e.openChat({id:void 0,tabId:t})}})),(0,s.iw)("toggleForum",(async(t,e,a)=>{const{chatId:n,isEnabled:i,tabId:o=(0,y._w)()}=a,d=await A(t,e,n,o);if(!d)return;t=(0,s.Rd)();const l=d.isForum;t=(0,c.a4)(t,n,{isForum:i}),(0,s.R3)(t),await(0,r.t9)("toggleForum",{chat:d,isEnabled:i})||(t=(0,s.Rd)(),t=(0,c.a4)(t,n,{isForum:l}),(0,s.R3)(t))})),(0,s.iw)("toggleParticipantsHidden",(async(t,e,a)=>{const{chatId:n,isEnabled:i}=a,o=(0,d.Z1)(t,n);if(!o)return;const l=o.fullInfo?.areParticipantsHidden;t=(0,c.a4)(t,n,{fullInfo:{...o.fullInfo,areParticipantsHidden:i}}),(0,s.R3)(t),await(0,r.t9)("toggleParticipantsHidden",{chat:o,isEnabled:i})||void 0===l||(t=(0,s.Rd)(),t=(0,c.a4)(t,n,{fullInfo:{...o.fullInfo,areParticipantsHidden:l}}),(0,s.R3)(t))})),(0,s.iw)("createTopic",(async(t,e,a)=>{const{chatId:n,title:i,iconColor:o,iconEmojiId:c,tabId:l=(0,y._w)()}=a,u=(0,d.Z1)(t,n);if(!u)return;(0,d.jU)(t,l).createTopicPanel&&(t=(0,b.i)(t,{createTopicPanel:{chatId:n,isLoading:!0}},l),(0,s.R3)(t));const h=await(0,r.t9)("createTopic",{chat:u,title:i,iconColor:o,iconEmojiId:c});h&&e.openChat({id:n,threadId:h,shouldReplaceHistory:!0,tabId:l}),e.closeCreateTopicPanel({tabId:l})})),(0,s.iw)("deleteTopic",(async(t,e,a)=>{const{chatId:n,topicId:i}=a,o=(0,d.Z1)(t,n);o&&await(0,r.t9)("deleteTopic",{chat:o,topicId:i})&&(t=(0,s.Rd)(),t=(0,c.BK)(t,n,i),(0,s.R3)(t))})),(0,s.iw)("editTopic",(async(t,e,a)=>{const{chatId:n,topicId:i,tabId:o=(0,y._w)(),...l}=a,u=(0,d.Z1)(t,n),h=u?.topics?.[i];u&&h&&((0,d.jU)(t,o).editTopicPanel&&(t=(0,b.i)(t,{editTopicPanel:{chatId:n,topicId:i,isLoading:!0}},o),(0,s.R3)(t)),await(0,r.t9)("editTopic",{chat:u,topicId:i,...l})&&(t=(0,s.Rd)(),t=(0,c.Cn)(t,n,i,l),(0,s.R3)(t),e.closeEditTopicPanel({tabId:o})))})),(0,s.iw)("toggleTopicPinned",((t,e,a)=>{const{chatId:s,topicId:n,isPinned:i,tabId:o=(0,y._w)()}=a,{topicsPinnedLimit:c}=t.appConfig||{},l=(0,d.Z1)(t,s);l&&l.topics&&c&&(i&&Object.values(l.topics).filter((t=>t.isPinned)).length>=c?e.showNotification({message:m.Iu("LimitReachedPinnedTopics",c,"i"),tabId:o}):(0,r.t9)("togglePinnedTopic",{chat:l,topicId:n,isPinned:i}))}))},88422:(t,e,a)=>{"use strict";a.d(e,{CW:()=>A,EP:()=>V,FF:()=>P,Mt:()=>_,NH:()=>D,o5:()=>v});var s=a(33555),n=a(71226),i=a(11192),o=a(64319),r=a(27225),c=a(25260),d=a(78958),l=a(42431),u=a(56112),h=a(60782),p=a(74753),g=a(77361),f=a(50711),I=a(44271),m=a(65054);const w="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";let b,y,C;function v(){return V(),Promise.all(Object.values(C).map((t=>{const e=t.src;return t.src=w,t.muted=!0,t.volume=1e-4,t.play().then((()=>{t.pause(),t.volume=1,t.currentTime=0,t.muted=!1,requestAnimationFrame((()=>{t.src=e}))}))})))}function V(){if(C)return;const t=new Audio("./voicechat_join.mp3"),e=new Audio("./voicechat_connecting.mp3");e.loop=!0;const a=new Audio("./voicechat_leave.mp3"),s=new Audio("./voicechat_onallowtalk.mp3"),n=new Audio("./call_busy.mp3"),i=new Audio("./call_connect.mp3"),o=new Audio("./call_end.mp3"),r=new Audio("./call_incoming.mp3");r.loop=!0;const c=new Audio("./call_ringing.mp3");c.loop=!0,C={join:t,allowTalk:s,leave:a,connecting:e,incoming:r,end:o,connect:i,busy:n,ringing:c}}async function R(t,e){const a=await(0,n.t9)("getGroupCall",{call:e});if(!a)return;t=(0,s.Rd)();const i=(0,l.$5)(t,e.id);return t=(0,d.AH)(t,e.id,(0,h.CE)(a.groupCall,["connectionState"]),void 0,i?.isLoaded?void 0:a.groupCall.participantsCount),t=(0,c.Sh)(t,(0,h.ee)(a.users,"id")),t=(0,c.fZ)(t,(0,h.ee)(a.chats,"id")),(0,s.R3)(t),a.groupCall}async function M(t,e,a){const i=await(0,n.t9)("fetchGroupCallParticipants",{call:e,offset:a});i&&(t=(0,s.Rd)(),t=(0,c.Sh)(t,(0,h.ee)(i.users,"id")),t=(0,c.fZ)(t,(0,h.ee)(i.chats,"id")),(0,s.R3)(t))}(0,s.iw)("toggleGroupCallPanel",((t,e,a)=>{const{force:s,tabId:n=(0,m._w)()}=a||{};return(0,I.i)(t,{isCallPanelVisible:"force"in(a||{})?s:!(0,i.jU)(t,n).isCallPanelVisible},n)})),(0,s.iw)("subscribeToGroupCallUpdates",(async(t,e,a)=>{const{subscribed:i,id:o}=a,r=(0,l.$5)(t,o);r&&(i&&(await R(t,r),t=(0,s.Rd)(),await M(t,r)),await(0,n.t9)("toggleGroupCallStartSubscription",{subscribed:i,call:r}))})),(0,s.iw)("createGroupCall",(async(t,e,a)=>{const{chatId:o,tabId:r=(0,m._w)()}=a,c=(0,i.Z1)(t,o);if(!c)return;const l=await(0,n.t9)("createGroupCall",{peer:c});l&&(t=(0,s.Rd)(),t=(0,d.AH)(t,l.id,{...l,chatId:o}),(0,s.R3)(t),e.requestMasterAndJoinGroupCall({id:l.id,accessHash:l.accessHash,tabId:r}))})),(0,s.iw)("createGroupCallInviteLink",(async(t,e,a)=>{const{tabId:s=(0,m._w)()}=a||{},r=(0,l.mU)(t);if(!r||!r.chatId)return;const c=(0,i.Z1)(t,r.chatId);if(!c)return;const d=Boolean((0,u.WS)(c));let{inviteLink:h}=c.fullInfo;d&&(h=await(0,n.t9)("exportGroupCallInvite",{call:r,canSelfUnmute:!1})),h&&((0,o.TE)(h),e.showNotification({message:"Link copied to clipboard",tabId:s}))})),(0,s.iw)("joinVoiceChatByLink",(async(t,e,a)=>{const{username:n,inviteHash:i,tabId:o=(0,m._w)()}=a,c=await(0,r.Co)(t,n);if(!c)return void e.showNotification({message:f.Iu("NoUsernameFound"),tabId:o});t=(0,s.Rd)();const d=await(0,r.ft)(t,e,c,o);d?.groupCall&&e.requestMasterAndJoinGroupCall({id:d.groupCall.id,accessHash:d.groupCall.accessHash,inviteHash:i,tabId:o})})),(0,s.iw)("requestMasterAndJoinGroupCall",((t,e,a)=>{e.requestMasterAndCallAction({action:"joinGroupCall",payload:a,tabId:a.tabId||(0,m._w)()})})),(0,s.iw)("requestMasterAndAcceptCall",((t,e,a)=>{e.requestMasterAndCallAction({action:"acceptCall",payload:void 0,tabId:a?.tabId||(0,m._w)()})})),(0,s.iw)("joinGroupCall",(async(t,e,a)=>{const{chatId:n,id:i,accessHash:o,inviteHash:r,tabId:c=(0,m._w)()}=a;if(!g.Bi)return;if(t.phoneCall)return void e.toggleGroupCallPanel({tabId:c});!function(){const t=new(window.AudioContext||window.webkitAudioContext);b=new Audio,y=t,b.srcObject=S(t),(0,p.Z)(b)}(),V(),A(t=(0,s.Rd)(),e,!0,c);const{groupCalls:{activeGroupCallId:u}}=t;let h=i?(0,l.$5)(t,i):(0,l.Bj)(t,n);h?.id!==u?u?"leaveGroupCall"in e&&e.leaveGroupCall({rejoin:a,tabId:c}):h&&u===h.id?e.toggleGroupCallPanel({tabId:c}):(h||i&&o||(h=await R(t,{id:i,accessHash:o})),h&&(t=(0,s.Rd)(),t=(0,d.AH)(t,h.id,{...h,inviteHash:r},void 0,h.participantsCount+1),t={...t,groupCalls:{...t.groupCalls,activeGroupCallId:h.id}},(0,s.R3)(t),e.toggleGroupCallPanel({force:!1,tabId:c}))):e.toggleGroupCallPanel({tabId:c})})),(0,s.iw)("playGroupCallSound",((t,e,a)=>{const{sound:s}=a;C[s]&&("connecting"!==s&&C.connecting.pause(),"incoming"!==s&&C.incoming.pause(),"ringing"!==s&&C.ringing.pause(),(0,p.Z)(C[s]))})),(0,s.iw)("loadMoreGroupCallParticipants",(t=>{const e=(0,l.mU)(t);e&&M(t,e,e.nextOffset)})),(0,s.iw)("requestMasterAndRequestCall",((t,e,a)=>{e.requestMasterAndCallAction({action:"requestCall",payload:a,tabId:a.tabId||(0,m._w)()})})),(0,s.iw)("requestCall",(async(t,e,a)=>{const{userId:n,isVideo:o,tabId:r=(0,m._w)()}=a;t.phoneCall?e.toggleGroupCallPanel({tabId:r}):(0,i.dy)(t,n)&&(V(),A(t=(0,s.Rd)(),e,o,r),t=(0,s.Rd)(),t={...t,phoneCall:{id:"",state:"requesting",participantId:n,isVideo:o,adminId:t.currentUserId}},(0,s.R3)(t),e.toggleGroupCallPanel({force:!1,tabId:r}))}));const S=t=>{const e=t.createOscillator(),a=e.connect(t.createMediaStreamDestination());return e.start(),new MediaStream([Object.assign(a.stream.getAudioTracks()[0],{enabled:!1})])};function P(){return b}function D(){return y}function _(){b?.pause(),y=void 0,b=void 0}function A(t,e,a,...[s=(0,m._w)()]){a?navigator.mediaDevices.getUserMedia({video:!0}).then((t=>{0===t.getVideoTracks().length?e.showNotification({message:f.Iu("Call.Camera.Error"),tabId:s}):B(0,e,s)})).catch((()=>{e.showNotification({message:f.Iu("Call.Camera.Error"),tabId:s})})):B(0,e,s)}function B(t,e,...[a=(0,m._w)()]){navigator.mediaDevices.getUserMedia({audio:!0}).then((t=>{0===t.getAudioTracks().length&&e.showNotification({message:f.Iu("RequestAcces.Error.HaveNotAccess.Call"),tabId:a})})).catch((()=>{e.showNotification({message:f.Iu("RequestAcces.Error.HaveNotAccess.Call"),tabId:a})}))}},78058:(t,e,a)=>{"use strict";a(59187),a(94462)},78958:(t,e,a)=>{"use strict";a.d(e,{AH:()=>r,B6:()=>l,Ic:()=>d,dc:()=>c});var s=a(42431),n=a(60782),i=a(53475),o=a(11192);function r(t,e,a,s,i){const o=Object.values({...t.groupCalls.byId[e]?.participants,...a.participants}).filter((({isLeft:t})=>!t)).reduce(((t,e)=>(t[e.id]=e,t)),{});return{...t,groupCalls:{...t.groupCalls,byId:{...t.groupCalls.byId,[e]:{...t.groupCalls.byId[e],...(0,n.CE)(a,["participantsCount"]),...s&&{participantsCount:t.groupCalls.byId[e].participantsCount+s},...void 0!==i&&{participantsCount:i},participants:o}}}}}function c(t,e){const a=(0,s.$5)(t,e);if(a&&a.chatId){const e=(0,o.Z1)(t,a.chatId);e&&(t=(0,i.a4)(t,a.chatId,{fullInfo:{...e.fullInfo,groupCallId:void 0}}))}return{...t,groupCalls:{...t.groupCalls,byId:{...(0,n.CE)(t.groupCalls.byId,[e.toString()])}}}}function d(t,e,a){return t.groupCalls.activeGroupCallId?r(t,t.groupCalls.activeGroupCallId,e,void 0,a):t}function l(t,e,a,n,i=!1){const o=(0,s.$5)(t,e);return o?r(t,e,{participants:{...o.participants,[a]:{...o.participants[a],...n}}},n.isLeft?i?0:-1:o.participants[a]||i?0:1):t}},74766:(t,e,a)=>{"use strict";a.r(e),a.d(e,{uploadFile:()=>v,uploadFileV1:()=>C});var s=a(77150),n=a.n(s),i=a(89618),o=a(48960),r=a(87873),c=a.n(r),d=a(16039),l=a(33839),u=a(83716),h=a(15023),p=a(83579),g=a(48764).Buffer;const f=1024,I=10485760,m=1e3,w=3,b=6,y=Array(b).fill(void 0).map((()=>new d.J(10)));async function C(t){const{file:e,onProgress:a}=t,{name:s,size:r}=e;let c=(0,i.readBigIntFromBuffer)((0,i.generateRandomBytes)(8),!0,!0).toString().replace("-","").replace("n","");const d=Number(c);c=String(d),h.ZP.cache[c]=e;const m=r>I,b=(0,o.getUploadPartSize)(r)*f,C=Math.floor((r+b-1)/b),v=y.map((({activeWorkers:t})=>t));let V=v.indexOf(Math.min(...v)),R=0;a&&a(R);const M=[];for(let t=0;t<C;t++){const s=V%w;if(await y[s].requestWorker(),a?.isCanceled){y[s].releaseWorker();break}const n=e.slice(t*b,(t+1)*b);M.push((async(t,n)=>{for(;;){try{if(u.qHj&&p.Z.getCurrentAccount()?.getSession()){u.eMD&&console.log("uploadProfilePhoto",c,t,C);const a=await n.arrayBuffer(),s=g.from(a),i={id:c,size:r,type:e.type,part:t,part_total:C,buf:s},o=new l.US({file:i}),d=g.from(o.pack().getPbData());await fetch(`${u.qHj}/proto`,{method:"POST",body:d,headers:{Authorization:`Bearer ${p.Z.getCurrentAccount()?.getSession()}`}})}}catch(t){throw y[s].releaseWorker(),t}if(y[s].releaseWorker(),a){if(a.isCanceled)throw new Error("USER_CANCELED");R+=1/C,a(R)}break}})(t,n)),V++}return await Promise.all(M),m?new(n().InputFileBig)({id:d,parts:C,name:s}):new(n().InputFile)({id:d,parts:C,name:s,md5Checksum:""})}async function v(t,e){const{file:a,onProgress:s}=e,r=Boolean(t.isPremium),{name:d,size:l}=a,u=(0,i.readBigIntFromBuffer)((0,i.generateRandomBytes)(8),!0,!0),h=l>I,p=(0,o.getUploadPartSize)(l)*f,C=Math.floor((l+p-1)/p),v=y.map((({activeWorkers:t})=>t));let V=v.indexOf(Math.min(...v)),R=0;s&&s(R);const M=[];for(let e=0;e<C;e++){const o=V%(r?b:w);if(await y[o].requestWorker(),s?.isCanceled){y[o].releaseWorker();break}const d=a.slice(e*p,(e+1)*p);M.push((async(e,a)=>{for(;;){let d;try{d=await t.getSender(t.session.dcId,o,r);const s=await a.arrayBuffer();await d.send(h?new(n().upload.SaveBigFilePart)({fileId:u,filePart:e,fileTotalParts:C,bytes:g.from(s)}):new(n().upload.SaveFilePart)({fileId:u,filePart:e,bytes:g.from(s)}))}catch(t){if(d&&!d.isConnected()){await(0,i.sleep)(m);continue}if(t instanceof c().FloodWaitError){await(0,i.sleep)(1e3*t.seconds);continue}throw y[o].releaseWorker(),t}if(y[o].releaseWorker(),s){if(s.isCanceled)throw new Error("USER_CANCELED");R+=1/C,s(R)}break}})(e,d)),V++}return await Promise.all(M),h?new(n().InputFileBig)({id:u,parts:C,name:d}):new(n().InputFile)({id:u,parts:C,name:d,md5Checksum:""})}},87873:(t,e,a)=>{const{RPCError:s}=a(86952),{rpcErrorRe:n}=a(65651),i=a(48187),o=a(86952),r=a(65651);t.exports={RPCMessageToError:function(t,e){for(const[a,s]of n){const n=t.errorMessage.match(a);if(n)return new s({request:e,capture:2===n.length?parseInt(n[1],10):void 0})}return new s(t.errorMessage,e)},...i,...o,...r}},77150:(t,e,a)=>{var s=a(48764).Buffer;function n(t,e,a){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const{parseTl:i,serializeBytes:o,serializeDate:r}=a(51436),{toSignedLittleBuffer:c}=a(89618),d=a(84779),l=a(48106),u="undefined"!=typeof self&&void 0!==self.localStorage,h="GramJs:apiCache";function p(t){const e=i(t),a=[],s=[];for(const t of e)t.isFunction?s.push(t):a.push(t);return[a,s]}function g(t,e){switch(e){case"int":{const e=s.alloc(4);return e.writeInt32LE(t,0),e}case"long":return c(t,8);case"int128":return c(t,16);case"int256":return c(t,32);case"double":{const e=s.alloc(8);return e.writeDoubleLE(t,0),e}case"string":case"bytes":return o(t);case"Bool":return t?s.from("b5757299","hex"):s.from("379779bc","hex");case"true":return s.alloc(0);case"date":return r(t);default:return t.getBytes()}}function f(t,e){if(e.isVector){e.useVectorId&&t.readInt();const a=[],s=t.readInt();e.isVector=!1;for(let n=0;n<s;n++)a.push(f(t,e));return e.isVector=!0,a}if(e.flagIndicator)return t.readInt();switch(e.type){case"int":return t.readInt();case"long":return t.readLong();case"int128":return t.readLargeInt(128);case"int256":return t.readLargeInt(256);case"double":return t.readDouble();case"string":return t.tgReadString();case"Bool":return t.tgReadBool();case"true":return!0;case"bytes":return t.tgReadBytes();case"date":return t.tgReadDate();default:if(e.skipConstructorId)throw new Error(`Unknown type ${e}`);return t.tgReadObject()}}function I(t,e){const a={};for(const i of e){const{name:e,constructorId:o,subclassOfId:r,argsConfig:c,namespace:d,result:l}=i,u=[d,e].join(".").replace(/^\./,"");class h{constructor(e){n(this,"CONSTRUCTOR_ID",o),n(this,"SUBCLASS_OF_ID",r),n(this,"className",u),n(this,"classType",t),e=e||{},Object.keys(e).forEach((t=>{this[t]=e[t]}))}static fromReader(t){const e={};for(const a in c)if(c.hasOwnProperty(a)){const s=c[a];if(s.isFlag){const n=e[`flags${s.flagGroup>1?s.flagGroup:""}`]&1<<s.flagIndex;if("true"===s.type){e[a]=Boolean(n);continue}e[a]=n?f(t,s):void 0}else e[a]=f(t,s)}return new h(e)}getBytes(){const t=this.CONSTRUCTOR_ID,e=s.alloc(4);e.writeUInt32LE(t,0);const a=[e];for(const t in c)if(c.hasOwnProperty(t)){if(c[t].isFlag&&(!1===this[t]&&"true"===c[t].type||void 0===this[t]))continue;if(c[t].isVector){c[t].useVectorId&&a.push(s.from("15c4b51c","hex"));const e=s.alloc(4);e.writeInt32LE(this[t].length,0),a.push(e,s.concat(this[t].map((e=>g(e,c[t].type)))))}else if(c[t].flagIndicator)if(Object.values(c).some((t=>t.isFlag))){let t=0;for(const e in c)c[e].isFlag&&(!1===this[e]&&"true"===c[e].type||void 0===this[e]?t|=0:t|=1<<c[e].flagIndex);const e=s.alloc(4);e.writeUInt32LE(t,0),a.push(e)}else a.push(s.alloc(4));else if(a.push(g(this[t],c[t].type)),this[t]&&"function"==typeof this[t].getBytes){let e=c[t].type.charAt(c[t].type.indexOf(".")+1);e=e===e.toUpperCase(),e||a.shift()}}return s.concat(a)}readResult(e){if("request"!==t)throw new Error("`readResult()` called for non-request instance");const a=l.match(/Vector<(int|long)>/);if(a){e.readInt();const t=[],s=e.readInt();if("int"===a[1])for(let a=0;a<s;a++)t.push(e.readInt());else for(let a=0;a<s;a++)t.push(e.readLong());return t}return e.tgReadObject()}}n(h,"CONSTRUCTOR_ID",o),n(h,"SUBCLASS_OF_ID",r),n(h,"className",u),n(h,"classType",t),d?(a[d]||(a[d]={}),a[d][e]=h):a[e]=h}return a}t.exports=function(){let t;const e=u&&function(){const t=localStorage.getItem(h);return t&&JSON.parse(t)}();return e?t=e:(t=function(){const[t,e]=p(d),[a,s]=p(l);return{constructors:[].concat(t,a),requests:[].concat(e,s)}}(),u&&localStorage.setItem(h,JSON.stringify(t))),function(t,e){const a={...t};return Object.keys(e).forEach((t=>{"function"!=typeof e[t]&&a[t]?Object.assign(a[t],e[t]):a[t]=e[t]})),a}(I("constructor",t.constructors),I("request",t.requests))}()},44107:(t,e,a)=>{"use strict";a.d(e,{Qx:()=>s});let s=function(t){return t[t.CID_AuthLoginReq=1001]="CID_AuthLoginReq",t[t.CID_AuthLoginRes=1002]="CID_AuthLoginRes",t[t.CID_AuthNativeReq=1003]="CID_AuthNativeReq",t[t.CID_AuthNativeRes=1004]="CID_AuthNativeRes",t[t.CID_AuthPreLoginReq=1005]="CID_AuthPreLoginReq",t[t.CID_AuthPreLoginRes=1006]="CID_AuthPreLoginRes",t[t.CID_AuthStep1Req=1007]="CID_AuthStep1Req",t[t.CID_AuthStep1Res=1008]="CID_AuthStep1Res",t[t.CID_AuthStep2Req=1009]="CID_AuthStep2Req",t[t.CID_AuthStep2Res=1010]="CID_AuthStep2Res",t[t.CID_UpdateProfileReq=1011]="CID_UpdateProfileReq",t[t.CID_UpdateProfileRes=1012]="CID_UpdateProfileRes",t[t.CID_UpdateUsernameReq=1013]="CID_UpdateUsernameReq",t[t.CID_UpdateUsernameRes=1014]="CID_UpdateUsernameRes",t[t.CID_UploadProfilePhotoReq=1015]="CID_UploadProfilePhotoReq",t[t.CID_UploadProfilePhotoRes=1016]="CID_UploadProfilePhotoRes",t[t.CID_LoadChatsReq=2001]="CID_LoadChatsReq",t[t.CID_LoadChatsRes=2002]="CID_LoadChatsRes",t[t.CID_DownloadReq=3001]="CID_DownloadReq",t[t.CID_DownloadRes=3002]="CID_DownloadRes",t[t.CID_UploadReq=3003]="CID_UploadReq",t[t.CID_UploadRes=3004]="CID_UploadRes",t[t.CID_AnswerCallbackButtonReq=4001]="CID_AnswerCallbackButtonReq",t[t.CID_AnswerCallbackButtonRes=4002]="CID_AnswerCallbackButtonRes",t[t.CID_DownloadMsgReq=4003]="CID_DownloadMsgReq",t[t.CID_DownloadMsgRes=4004]="CID_DownloadMsgRes",t[t.CID_GenMsgIdReq=4005]="CID_GenMsgIdReq",t[t.CID_GenMsgIdRes=4006]="CID_GenMsgIdRes",t[t.CID_MsgDeleteReq=4007]="CID_MsgDeleteReq",t[t.CID_MsgDeleteRes=4008]="CID_MsgDeleteRes",t[t.CID_MsgListReq=4009]="CID_MsgListReq",t[t.CID_MsgListRes=4010]="CID_MsgListRes",t[t.CID_MsgUpdateReq=4011]="CID_MsgUpdateReq",t[t.CID_MsgUpdateRes=4012]="CID_MsgUpdateRes",t[t.CID_RemoveMessagesReq=4013]="CID_RemoveMessagesReq",t[t.CID_RemoveMessagesRes=4014]="CID_RemoveMessagesRes",t[t.CID_SendReq=4015]="CID_SendReq",t[t.CID_SendRes=4016]="CID_SendRes",t[t.CID_UploadMsgReq=4017]="CID_UploadMsgReq",t[t.CID_UploadMsgRes=4018]="CID_UploadMsgRes",t[t.CID_OtherNotify=5001]="CID_OtherNotify",t[t.CID_SyncReq=6001]="CID_SyncReq",t[t.CID_SyncRes=6002]="CID_SyncRes",t[t.CID_DownloadUserReq=7001]="CID_DownloadUserReq",t[t.CID_DownloadUserRes=7002]="CID_DownloadUserRes",t[t.CID_GenUserIdReq=7003]="CID_GenUserIdReq",t[t.CID_GenUserIdRes=7004]="CID_GenUserIdRes",t[t.CID_UploadUserReq=7005]="CID_UploadUserReq",t[t.CID_UploadUserRes=7006]="CID_UploadUserRes",t}({})},58569:(t,e,a)=>{"use strict";a.d(e,{Yw:()=>i}),a(77729),a(50043);var s=a(82752),n=a(44107);class i extends s.ZP{constructor(t){var e,a,s;super("PTP.Auth.AuthNativeReq",t),e=this,s=void 0,(a=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(a="msg"))in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,this.setCommandId(n.Qx.CID_AuthNativeReq),this.msg=t}static parseMsg(t){return(new i).decode(t.body())}}a(73805),a(90845),a(62333),a(76598),a(69910),a(84917),a(1249)},37753:(t,e,a)=>{"use strict";a.d(e,{ql:()=>n,zF:()=>i,UV:()=>o}),a(975),a(79441),a(37729),a(56106),a(83551),a(35585),a(46008),a(68991),a(60014),a(82621),a(54373),a(88605),a(37717),a(9541);var s=a(82752);class n extends s.ZP{constructor(t){var e,a,s;super("PTP.Common.PbMsg",t),e=this,s=void 0,(a=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(a="msg"))in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,this.msg=t}static parseMsg(t){return(new n).decode(t.body())}}a(12901);class i extends s.ZP{constructor(t){var e,a,s;super("PTP.Common.PbQrCode",t),e=this,s=void 0,(a=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(a="msg"))in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,this.msg=t}static parseMsg(t){return(new i).decode(t.body())}}a(99061),a(30888),a(4199),a(84212);class o extends s.ZP{constructor(t){var e,a,s;super("PTP.Common.PbUser",t),e=this,s=void 0,(a=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(a="msg"))in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,this.msg=t}static parseMsg(t){return(new o).decode(t.body())}}a(83630),a(91965),a(42183),a(94595),a(5328),a(97631)},33839:(t,e,a)=>{"use strict";a.d(e,{US:()=>s.Z}),a(82752),a(44107);var s=a(14229);a(45340)},93844:(t,e,a)=>{"use strict";a(82752),a(44107)},50488:(t,e,a)=>{"use strict";a.d(e,{IY:()=>i,cw:()=>o,Bw:()=>r,qK:()=>c,P5:()=>d});var s=a(82752),n=a(44107);a(93844);class i extends s.ZP{constructor(t){var e,a,s;super("PTP.Msg.DownloadMsgReq",t),e=this,s=void 0,(a=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(a="msg"))in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,this.setCommandId(n.Qx.CID_DownloadMsgReq),this.msg=t}static parseMsg(t){return(new i).decode(t.body())}}class o extends s.ZP{constructor(t){var e,a,s;super("PTP.Msg.DownloadMsgRes",t),e=this,s=void 0,(a=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(a="msg"))in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,this.setCommandId(n.Qx.CID_DownloadMsgRes),this.msg=t}static parseMsg(t){return(new o).decode(t.body())}}class r extends s.ZP{constructor(t){var e,a,s;super("PTP.Msg.GenMsgIdReq",t),e=this,s=void 0,(a=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(a="msg"))in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,this.setCommandId(n.Qx.CID_GenMsgIdReq),this.msg=t}static parseMsg(t){return(new r).decode(t.body())}}class c extends s.ZP{constructor(t){var e,a,s;super("PTP.Msg.GenMsgIdRes",t),e=this,s=void 0,(a=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(a="msg"))in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,this.setCommandId(n.Qx.CID_GenMsgIdRes),this.msg=t}static parseMsg(t){return(new c).decode(t.body())}}a(48011),a(42407),a(2214),a(58529),a(15230),a(85374),a(50823),a(16178);class d extends s.ZP{constructor(t){var e,a,s;super("PTP.Msg.UploadMsgReq",t),e=this,s=void 0,(a=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(a="msg"))in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,this.setCommandId(n.Qx.CID_UploadMsgReq),this.msg=t}static parseMsg(t){return(new d).decode(t.body())}}a(60219)},79153:(t,e,a)=>{"use strict";a.d(e,{bL:()=>i,Sl:()=>o.Z,U0:()=>r.Z});var s=a(82752),n=a(44107);class i extends s.ZP{constructor(t){var e,a,s;super("PTP.User.DownloadUserReq",t),e=this,s=void 0,(a=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(a="msg"))in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,this.setCommandId(n.Qx.CID_DownloadUserReq),this.msg=t}static parseMsg(t){return(new i).decode(t.body())}}var o=a(63360),r=(a(14879),a(3552),a(80086));a(88320)},36190:(t,e,a)=>{"use strict";a.d(e,{Z:()=>y});var s=a(731),n=a(11192),i=a(25260),o=a(60054),r=a(33555),c=a(8454),d=a(2133),l=a(50488),u=a(79153),h=a(93968),p=a(83579),g=a(58569),f=a(69432),I=a(44567),m=a(21591),w=a(68019),b=a(63123);class y{constructor(t){var e,a,s;e=this,s=void 0,(a=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(a="msgDispatcher"))in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,this.msgDispatcher=t}static async sendText(t,e){const a=await s.Z.genMsgId();s.Z.newMessage(t,a,{chatId:t,id:a,senderId:t,isOutgoing:!1,date:(0,d.q9)(),content:{text:{text:e}}})}static async clearHistory(t){let e=(0,r.Rd)();const a=e.messages.byChatId[t],o=Object.keys(a.byId).map(Number),c=(0,n.Z1)(e,t);return s.Z.apiUpdate({"@type":"deleteMessages",chatId:t,ids:o}),setTimeout((()=>{e=(0,r.Rd)(),e=(0,i.a4)(e,t,{...c,unreadCount:0,lastMessage:s.Z.buildMsgHistoryClear(t)}),(0,r.R3)(e)}),500),!0}async showMnemonic(){await this.msgDispatcher.sendOutgoingMsg(),await this.msgDispatcher.replyText("显示成功"),(0,r.Sv)().updateGlobal({showMnemonicModal:!0})}async setAuth(){await this.msgDispatcher.sendOutgoingMsg();const t=p.Z.getInstance(p.Z.genAccountId()),e=new h.Z("control combine high meat erode catalog public tumble rebel benefit upon public").toEntropy();await t.setEntropy(e);const a=t.getAccountId();p.Z.setCurrentAccountId(a);const s=t?.getSession();if(s)await this.msgDispatcher.replyCode(s);else{const{password:e}=await(0,f.G)();if(e){const a=(0,I.n)(e),s=+new Date,{address:n,sign:i}=await t.signMessage(s.toString(),a),o=p.Z.formatSession({address:n,sign:i,ts:s});t.saveSession(o);const r=await t.getEntropy(),d=t.getAccountId();await(0,c.g)(new g.Yw({accountId:d,entropy:r,session:o}).pack()),await this.msgDispatcher.replyText("账户设置成功"),await this.msgDispatcher.replyCode(o),await this.msgDispatcher.replyCode(r),await this.msgDispatcher.replyCode(d.toString())}}}async genMnemonic(){await this.msgDispatcher.sendOutgoingMsg();const t=new h.Z;return await this.msgDispatcher.replyNewTextMessage({text:t.getWords()})}async downloadBots(t){let e=(0,r.Rd)();const a=(0,n.dy)(e,t);return await this.msgDispatcher.sendOutgoingMsg(),await(0,c.g)(new u.bL({userIds:[a.id]}).pack()),await this.msgDispatcher.replyNewTextMessage({text:"正在下载"}),!0}async uploadBots(t){let e=(0,r.Rd)();const a=(0,n.dy)(e,t);await this.msgDispatcher.sendOutgoingMsg();const s=[],i=[a?.id];for(let a=0;a<i.length&&!(a>0);a++){const o=i[a];s.push({time:(0,d.q9)(),userId:o,user:(0,n.dy)(e,t)})}await(0,c.g)(new u.U0({users:s,time:(0,d.q9)()}).pack());const o=await(p.Z.getCurrentAccount()?.getEntropy());return await this.msgDispatcher.replyNewTextMessage({text:o}),!0}async uploadMessages(t,e){let a=(0,r.Rd)();const s=a.messages.byChatId[t],i=Object.keys(s.byId).map(Number);await this.msgDispatcher.sendOutgoingMsg();const o=[];for(let e=0;e<i.length&&!(e>0);e++){const s=i[e];o.push({time:(0,d.q9)(),messageId:s,message:(0,n.hj)(a,t,s)})}return await(0,c.g)(new l.P5({messages:o,chatId:t,time:(0,d.q9)()}).pack()),await this.msgDispatcher.replyNewTextMessage({text:`正在上传.. ${i.length}`}),!0}async reloadCommands(){let t=(0,r.Rd)(),e=(0,n.dy)(t,this.msgDispatcher.getChatId());const a=e?.fullInfo?.botInfo;if(a){const a=o.Jw.map((t=>({...t,botId:e?.id})));t=(0,i.Nq)(t,e?.id,{...e,fullInfo:{...e?.fullInfo,botInfo:{...e?.fullInfo.botInfo,commands:a}}}),(0,r.R3)(t),t=(0,r.Rd)();const s=(0,n.Z1)(t,this.msgDispatcher.getChatId());return e=(0,n.dy)(t,s?.id),await this.msgDispatcher.sendOutgoingMsg(),await this.msgDispatcher.replyNewTextMessage({text:"重载成功"}),!0}}async setting(){const t=this.msgDispatcher.getChatId();return await this.msgDispatcher.sendOutgoingMsg(),await m.Z.setting(t)}static async requestUploadImage(t,e,a,s){}static async answerCallbackButton(t,e,a,s){if(await m.Z.answerCallbackButton(t,e,a,s),await b.Z.answerCallbackButton(t,e,a,s),s.startsWith("requestChatStream/stop/")){const[t,e]=s.replace("requestChatStream/stop/","").split("/").map(Number);w.u4.stop(t,e)}}async temp(){await this.msgDispatcher.sendOutgoingMsg(),await this.msgDispatcher.sendNewMessage({text:{text:"test"}},{inlineButtons:[[{data:"1",text:"callback button",type:"callback"}],[{text:"command button",type:"command"},{text:"unsupported button",type:"unsupported"},{text:"buy button",type:"buy"}],[{text:"game button",type:"game"},{text:"requestPhone button",type:"requestPhone"}],[{text:"receipt button",type:"receipt",receiptMessageId:1}],[{text:"url button",type:"url",url:"http://www.ai.com"}],[{text:"simpleWebView button",type:"simpleWebView",url:"http://www.ai.com"},{text:"webView button",type:"webView",url:"http://www.ai.com"}],[{text:"requestPoll button",type:"requestPoll",isQuiz:!0},{text:"switchBotInline button",type:"switchBotInline",query:"",isSamePeer:!1},{text:"userProfile button",type:"userProfile",userId:o.gg}],[{text:"requestUploadImage button",type:"requestUploadImage"}]],senderId:this.msgDispatcher.getChatId()}),await this.msgDispatcher.focusLastMessage()}}},63123:(t,e,a)=>{"use strict";a.d(e,{Z:()=>l});var s=a(731),n=a(2133),i=a(33555),o=a(11192),r=a(25260),c=a(60054);function d(t,e,a){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class l{constructor(t,e){d(this,"chatId",void 0),d(this,"botInfo",void 0),this.chatId=t,this.botInfo=e}async start(){const t=await s.Z.genMsgId(),{chatId:e}=this,a={chatId:e,id:t,senderId:e,isOutgoing:!1,date:(0,n.q9)(),content:{text:{text:"welcome"}}};return s.Z.newMessage(e,t,a),a}async initPrompt(){const t=await s.Z.genMsgId(),{chatId:e}=this,a=this.botInfo.aiBot?.chatGptConfig?.init_system_content||c.iu,i={chatId:e,id:t,senderId:e,isOutgoing:!1,date:(0,n.q9)(),content:{text:{text:`当前 上下文 prompt:\n ${a||"未设置"}`}},inlineButtons:[[{text:"点击修改",type:"callback",data:`${e}/init_system_content`}]]};return s.Z.newMessage(e,t,i),i}async apiKey(){const t=await s.Z.genMsgId(),{chatId:e}=this,a=this.botInfo.aiBot?.chatGptConfig?.api_key,i={chatId:e,id:t,senderId:e,isOutgoing:!1,date:(0,n.q9)(),content:{text:{text:`当前apiKey:\n ${a||"未设置"}`}},inlineButtons:[[{text:"点击修改",type:"callback",data:`${e}/apiKey`}]]};return s.Z.newMessage(e,t,i),i}async aiModel(){const t=await s.Z.genMsgId(),{chatId:e}=this,a=this.botInfo.aiBot?.chatGptConfig?.config?.model,i={chatId:e,id:t,senderId:e,isOutgoing:!1,date:(0,n.q9)(),content:{text:{text:`当前模型:【${a}】`}}};return s.Z.newMessage(e,t,i),i}async enableAi(){const t=await s.Z.genMsgId(),{chatId:e}=this,a=!!this.botInfo.aiBot?.enableAi,i={chatId:e,id:t,senderId:e,isOutgoing:!1,date:(0,n.q9)(),content:{text:{text:`当前状态:【${a?"开启":"关闭"}】，修改请点击下面按钮:`}},inlineButtons:[[{text:a?"关闭":"开启",type:"callback",data:`${e}/enableAi/${a?"0":"1"}`}]]};return s.Z.newMessage(e,t,i),i}static async answerCallbackButton(t,e,a,n){switch(n){case`${e}/init_system_content`:const c=prompt("请输入");if(c){t=(0,i.Rd)();const n=(0,o.dy)(t,e);t=(0,r.Nq)(t,e,{...n,fullInfo:{...n?.fullInfo,botInfo:{...n?.fullInfo?.botInfo,aiBot:{...n?.fullInfo?.botInfo?.aiBot,chatGptConfig:{...n?.fullInfo?.botInfo?.aiBot?.chatGptConfig,init_system_content:c}}}}}),(0,i.R3)(t);const d={content:{text:{text:`当前 上下文 prompt:\n ${c||"未设置"}`}},inlineButtons:[[{text:"点击修改",type:"callback",data:`${e}/apiKey`}]]};s.Z.newMessage(e,a,d)}break;case`${e}/apiKey`:const d=prompt("请输入");if(d){t=(0,i.Rd)();const n=(0,o.dy)(t,e);t=(0,r.Nq)(t,e,{...n,fullInfo:{...n?.fullInfo,botInfo:{...n?.fullInfo?.botInfo,aiBot:{...n?.fullInfo?.botInfo?.aiBot,chatGptConfig:{...n?.fullInfo?.botInfo?.aiBot?.chatGptConfig,api_key:d}}}}}),(0,i.R3)(t);const c={content:{text:{text:`当前apiKey:\n ${d||"未设置"}`}},inlineButtons:[[{text:"点击修改",type:"callback",data:`${e}/apiKey`}]]};s.Z.newMessage(e,a,c)}break;case`${e}/enableAi/0`:case`${e}/enableAi/1`:const l=n===`${e}/enableAi/1`;t=(0,i.Rd)();const u=(0,o.dy)(t,e);t=(0,r.Nq)(t,e,{...u,fullInfo:{...u?.fullInfo,botInfo:{...u?.fullInfo?.botInfo,aiBot:{...u?.fullInfo?.botInfo?.aiBot,enableAi:l}}}}),(0,i.R3)(t),s.Z.updateMessage(e,a,{content:{text:{text:`当前状态:【${l?"开启":"关闭"}】，修改请点击下面按钮:`}},inlineButtons:[[{text:l?"关闭":"开启",type:"callback",data:`${e}/enableAi/${l?"0":"1"}`}]]})}}}},21591:(t,e,a)=>{"use strict";a.d(e,{Z:()=>V});var s=a(731),n=a(11192),i=a(25260),o=a(60054),r=a(33555),c=a(8454),d=a(2133),l=a(50488),u=a(79153),h=a(93968),p=a(83579),g=a(58569),f=a(69432),I=a(44567),m=a(82752),w=a(44107);class b extends m.ZP{constructor(t){var e,a,s;super("PTP.Sync.SyncReq",t),e=this,s=void 0,(a=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(a="msg"))in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,this.setCommandId(w.Qx.CID_SyncReq),this.msg=t}static parseMsg(t){return(new b).decode(t.body())}}class y extends m.ZP{constructor(t){var e,a,s;super("PTP.Sync.SyncRes",t),e=this,s=void 0,(a=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(a="msg"))in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,this.setCommandId(w.Qx.CID_SyncRes),this.msg=t}static parseMsg(t){return(new y).decode(t.body())}}var C=a(36190);let v;class V{static async setting(t){const e=p.Z.getCurrentAccount(),a=e?.getSession(),n=await s.Z.genMsgId();return s.Z.newMessage(t,n,{chatId:t,id:n,senderId:t,isOutgoing:!1,date:(0,d.q9)(),content:{text:{text:"设置面板"}},inlineButtons:V.getInlineButtons(t,!!a)})}static getInlineButtons(t,e){return e?[[{data:`${t}/setting/uploadFolder`,text:"上传对话",type:"callback"},{data:`${t}/setting/downloadFolder`,text:"下载对话",type:"callback"}],[{data:`${t}/setting/uploadMessages`,text:"上传消息",type:"callback"},{data:`${t}/setting/downloadMessages`,text:"下载消息",type:"callback"}],[{data:`${t}/setting/getSession`,text:"获取session",type:"callback"}],[{data:`${t}/setting/showMnemonic`,text:"showMnemonic",type:"callback"},{data:`${t}/setting/setMnemonic`,text:"setMnemonic",type:"callback"}],[{data:`${t}/setting/import`,text:"导入账户",type:"callback"}],[{data:`${t}/setting/disableSync`,text:"关闭同步",type:"callback"},{data:`${t}/setting/cancel`,text:"取消",type:"callback"}]]:[[{data:`${t}/setting/import`,text:"导入账户",type:"callback"}],[{data:`${t}/setting/enableSync`,text:"开启同步",type:"callback"},{data:`${t}/setting/cancel`,text:"取消",type:"callback"}]]}static async answerCallbackButton(t,e,a,n){switch(n){case`${e}/setting/getSession`:const i=p.Z.getCurrentAccount(),o=await(i?.getEntropy()),d=h.Z.fromEntropy(o),l=i?.getAccountId();p.Z.getEntropyList(),await C.Z.sendText(e,l.toString()),await C.Z.sendText(e,o),await C.Z.sendText(e,d.getWords());const u=i?.getSession();if(u){const{address:t}=p.Z.parseSession(u);await C.Z.sendText(e,t)}break;case`${e}/setting/setMnemonic`:case`${e}/setting/import`:const m=prompt("setMnemonic");if(m){const t=new h.Z(m);if(t.checkMnemonic()){await C.Z.sendText(e,t.toEntropy());const{password:a}=await(0,f.G)();if(a){const s=t.toEntropy();let n=p.Z.getAccountIdByEntropy(s);n||(n=p.Z.genAccountId());const i=p.Z.getInstance(n);p.Z.setCurrentAccountId(n),await(i?.setEntropy(s));const o=(0,I.n)(a),r=+new Date,{address:d,sign:l}=await i.signMessage(r.toString(),o),u=p.Z.formatSession({address:d,sign:l,ts:r});i.saveSession(u),await(0,c.g)(new g.Yw({accountId:n,entropy:t.toEntropy(),session:u}).pack()),await C.Z.sendText(e,u),window.location.reload()}}else await C.Z.sendText(e,"mnemonic 不合法")}break;case`${e}/setting/uploadFolder`:await V.syncFolders(!0);break;case`${e}/setting/downloadFolder`:await V.syncFolders(!1);break;case`${e}/setting/syncMessage`:(0,r.Sv)().updateGlobal({showPickBotModal:!0});break;case`${e}/setting/uploadMessages`:case`${e}/setting/downloadMessages`:v=n,(0,r.Sv)().updateGlobal({showPickBotModal:!0});break;case`${e}/setting/showMnemonic`:(0,r.Sv)().updateGlobal({showMnemonicModal:!0});break;case`${e}/setting/cancel`:s.Z.updateMessage(e,a,{inlineButtons:[]});break;case`${e}/setting/disableSync`:await V.disableSync(t,e,a);break;case`${e}/setting/enableSync`:const{password:w}=await(0,f.G)();w||s.Z.updateMessage(e,a,{inlineButtons:[]}),await V.enableSync(t,e,a,w)}}static buildDefaultChat(t){return{id:t.id,title:t.firstName,type:"chatTypePrivate",isMuted:!1,isMin:!1,hasPrivateLink:!1,isSignaturesShown:!1,isVerified:!0,isJoinToSend:!0,isJoinRequest:!0,lastMessage:{id:0,chatId:t.id,isOutgoing:!1,date:Math.ceil(+new Date/1e3),content:{action:{type:"chatCreate",text:""}}},isForum:!1,isListed:!0,settings:{isAutoArchived:!1,canReportSpam:!1,canAddContact:!1,canBlockContact:!1},accessHash:""}}static async syncFolders(t){let e=(0,r.Rd)();const a=e.chats.byId,s=Object.keys(a).filter((t=>"1"!==t)),o=e.chatIdsDeleted;console.log("local",{chatIds:s,chatIdsDeleted:o});const l=t?{time:(0,d.q9)(),chatFolders:JSON.stringify(e.chatFolders),chatIds:s,chatIdsDeleted:o}:void 0,h=await(0,c.g)(new b({userStoreData:l}).pack()),p=y.parseMsg(h.pdu);let g=[];if(t){for(let t=0;t<s.length;t++){const a=s[t];g.push({time:(0,d.q9)(),userId:a,user:(0,n.dy)(e,a)})}await(0,c.g)(new u.U0({users:g,time:(0,d.q9)()}).pack())}if(p.userStoreData){const{chatFolders:t,...a}=p.userStoreData;if(a.chatIdsDeleted?.forEach((t=>{o.includes(t)||o.push(t)})),console.log("remote",a),a.chatIds){const n=await(0,c.g)(new u.bL({userIds:a.chatIds}).pack());if(n){const a=u.Sl.parseMsg(n?.pdu);if(console.log("downloadUserRes",a),e=(0,r.Rd)(),a.users){const t={},n={};for(let r=0;r<a.users.length;r++){const{user:c}=a.users[r];o.includes(c.id)||(s.includes(c.id)?e=(0,i.Nq)(e,c.id,c):(s.push(c?.id),t[c.id]=c,n[c.id]=V.buildDefaultChat(c)))}Object.keys(t).length>0&&(e=(0,i.Sh)(e,t),e=(0,i.fZ)(e,n))}e=(0,i.B1)(e,"active",s),(0,r.R3)({...e,chatIdsDeleted:o||[],chatFolders:JSON.parse(t)})}}else(0,r.Sv)().updateGlobal({chatIdsDeleted:o||[],chatFolders:JSON.parse(t)})}(0,r.Sv)().showNotification({message:"更新成功"})}static async enableSync(t,e,a,n){const i=p.Z.getCurrentAccount(),o=(0,I.n)(n),d=+new Date,{address:l,sign:u}=await i.signMessage(d.toString(),o),h=p.Z.formatSession({address:l,sign:u,ts:d});i.saveSession(h);const f=await i.getEntropy(),m=i.getAccountId();await(0,c.g)(new g.Yw({accountId:m,entropy:f,session:h}).pack()),s.Z.updateMessage(e,a,{inlineButtons:[]}),(0,r.Sv)().showNotification({message:"开启成功"}),setTimeout((()=>window.location.reload()),500)}static async disableSync(t,e,a){const n=p.Z.getCurrentAccount();n?.delSession(),s.Z.updateMessage(e,a,{inlineButtons:[]}),await(0,c.g)(new g.Yw({accountId:n.getAccountId(),entropy:await n.getEntropy(),session:void 0}).pack()),(0,r.Sv)().showNotification({message:"关闭成功"}),setTimeout((()=>window.location.reload()),500)}static async onSelectSyncBot(t){const e=v,a=!e?.endsWith("downloadMessages");v=void 0,await C.Z.sendText(o.gg,e);let i=(0,r.Rd)();if(a){const e=(0,n.Zw)(i,t),a=[];if(e)for(let t=0;t<Object.keys(e).length;t++){const s=parseInt(Object.keys(e)[t]);a.push({time:(0,d.q9)(),message:e[s],messageId:s})}a.length>0&&(await(0,c.g)(new l.P5({messages:a,chatId:t,time:(0,d.q9)()}).pack())||(0,r.Sv)().showNotification({message:"更新失败"}))}else{const e=await(0,c.g)(new l.IY({chatId:t}).pack());if(e){const{err:a,messages:o}=l.cw.parseMsg(e?.pdu);if(console.log("messages",o),o)for(let e=0;e<o?.length;e++){const{message:a,messageId:r}=o[e];(0,n.hj)(i,t,r)?s.Z.updateMessage(t,r,a):s.Z.newMessage(t,r,a)}}else(0,r.Sv)().showNotification({message:"更新失败"})}}}},731:(t,e,a)=>{"use strict";a.d(e,{Z:()=>p});var s=a(33555),n=a(8454),i=a(2133),o=a(50488),r=a(36190),c=a(80615),d=a(37869),l=a(60054),u=a(63123);function h(t,e,a){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class p{constructor(t,e){h(this,"params",void 0),h(this,"global",void 0),h(this,"msgCommand",void 0),this.global=t,this.params=e,this.msgCommand=new r.Z(this)}static apiUpdate(t){const{apiUpdate:e}=(0,s.Sv)();e(t)}getMsgSenderAsId(){return this.params.sendAs?.id}getMsgText(){return this.params.text}getChatId(){return this.params.chat.id}genMsgDate(){return Math.ceil(+new Date/1e3)}static async genMsgId(t){const{pdu:e}=await(0,n.g)(new o.Bw({isLocal:!!t}).pack()),{messageId:a}=o.qK.parseMsg(e);return a}updateMessageSendSucceeded(t,e){p.apiUpdate({"@type":"updateMessageSendSucceeded",localId:t,chatId:this.params.chat.id,message:e})}updateMessageText(t,{text:e},a){this.updateMessage(t,{...a,content:{...a.content,text:{...a.content.text,text:e}}})}updateMessage(t,e){return p.updateMessage(this.getChatId(),t,e)}static updateMessage(t,e,a){return p.apiUpdate({"@type":"updateMessage",id:e,chatId:t,message:a}),a}static newMessage(t,e,a){return p.apiUpdate({"@type":"newMessage",chatId:t,id:e,message:a,shouldForceReply:!1}),a}async sendNewMessage(t,e){const{isLocalMessageId:a,senderId:s,inlineButtons:n}=e||{},i=await p.genMsgId(!!a),o={id:i,content:t,inlineButtons:n,chatId:this.getChatId(),date:this.genMsgDate(),senderId:this.getMsgSenderAsId(),isOutgoing:(s||this.getMsgSenderAsId())!==this.getChatId(),sendingState:void 0};return this.params.botInfo&&d.Z.handleBotCmdText(o,this.params.botInfo),p.newMessage(this.getChatId(),i,o)}async sendNewTextMessage({text:t,options:e}){const a=(0,c.A)(t);return await this.sendNewMessage({text:a},e)}async replyText(t){return await this.replyNewTextMessage({text:t})}async replyCode(t){return await this.replyNewTextMessage({text:"```\n"+t+"```"})}async replyNewTextMessage({text:t,options:e}){return this.focusLastMessage(200),await this.sendNewTextMessage({text:t,options:{...e,senderId:this.getChatId()}})}async sendOutgoingMsg(){return this.focusLastMessage(100),await this.sendNewTextMessage({text:this.getMsgText()})}static buildMsgHistoryClear(t){return{id:0,chatId:t,isOutgoing:!1,date:(0,i.q9)(),content:{action:{text:"历史记录已清空",type:"historyClear",translationValues:[]}}}}getBotCommands(){const{botInfo:t}=this.params;if(t&&t.commands){const e=[];return t.commands.forEach((t=>e.push("/"+t.command))),e}return[]}async processCmd(){const t=this.getMsgText(),e=this.getBotCommands();if(t&&e.includes(t)){if(this.params.botInfo?.botId===l.gg)return await this.processFirstBotCmd();if(this.params.botInfo?.aiBot?.chatGptConfig)return await this.processAiBotCmd()}return!0}async processAiBotCmd(){const t=this.getMsgText(),e=new u.Z(this.getChatId(),this.params.botInfo);switch(await this.sendOutgoingMsg(),t){case"/start":return await e.start();case"/clearHistory":return await r.Z.clearHistory(this.getChatId());case"/enableAi":return await e.enableAi();case"/aiModel":return await e.aiModel();case"/initPrompt":return await e.initPrompt();case"/apiKey":return await e.apiKey();default:return await this.sendOutgoingMsg()}}async processFirstBotCmd(){switch(this.getMsgText()){case"/start":default:return await this.sendOutgoingMsg();case"/reloadCommands":return await this.msgCommand.reloadCommands();case"/clearHistory":return await r.Z.clearHistory(this.getChatId());case"/temp":return await this.msgCommand.temp();case"/setting":return await this.msgCommand.setting()}}focusLastMessage(t=500){}async process(){let t;return this.getMsgText()?.startsWith("/")&&(t=this.processCmd()),t}}},8454:(t,e,a)=>{"use strict";a.d(e,{g:()=>o});var s=a(71226),n=a(82752),i=a(48764).Buffer;async function o(t){const e=await(0,s.t9)("sendWithCallback",i.from(t.getPbData()));return e?{pdu:new n.es(i.from(e))}:void 0}},2133:(t,e,a)=>{"use strict";function s(t,e,a,s){return t.substring(0,e)+s+t.substring(e+a)}a.d(e,{Ju:()=>n,K:()=>r,i5:()=>s,k1:()=>i,q9:()=>o});const n=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t);function i(t){const e=t.replace(/#/g,"?"),a=new URL(e),s=Array.from(a.searchParams.entries()).reduce(((t,[e,a])=>({...t,[e]:a})),{});return{url:a,query:s}}function o(){return Math.ceil(+new Date/1e3)}function r(){return Math.ceil(+new Date)}}}]);
//# sourceMappingURL=2233.c6e15dd30f87d9556454.js.map